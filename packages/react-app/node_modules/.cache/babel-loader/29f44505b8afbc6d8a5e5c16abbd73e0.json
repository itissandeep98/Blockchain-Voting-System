{"ast":null,"code":"var _slicedToArray = require(\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _classCallCheck = require(\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _assertThisInitialized = require(\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/assertThisInitialized\");\n\nvar _inherits = require(\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar Backoff = require('backoff');\n\nvar EventEmitter = require('events');\n\nvar inherits = require('util').inherits;\n\nvar WebSocket = global.WebSocket || require('ws');\n\nvar Subprovider = require('./subprovider');\n\nvar createPayload = require('../util/create-payload');\n\nvar WebsocketSubprovider = /*#__PURE__*/function (_Subprovider) {\n  \"use strict\";\n\n  _inherits(WebsocketSubprovider, _Subprovider);\n\n  var _super = _createSuper(WebsocketSubprovider);\n\n  function WebsocketSubprovider(_ref) {\n    var _this;\n\n    var rpcUrl = _ref.rpcUrl,\n        debug = _ref.debug,\n        origin = _ref.origin;\n\n    _classCallCheck(this, WebsocketSubprovider);\n\n    _this = _super.call(this); // inherit from EventEmitter\n\n    EventEmitter.call(_assertThisInitialized(_this));\n    Object.defineProperties(_assertThisInitialized(_this), {\n      _backoff: {\n        value: Backoff.exponential({\n          randomisationFactor: 0.2,\n          maxDelay: 5000\n        })\n      },\n      _connectTime: {\n        value: null,\n        writable: true\n      },\n      _log: {\n        value: debug ? function () {\n          for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n            args[_key] = arguments[_key];\n          }\n\n          return console.info.apply(console, ['[WSProvider]'].concat(args));\n        } : function () {}\n      },\n      _origin: {\n        value: origin\n      },\n      _pendingRequests: {\n        value: new Map()\n      },\n      _socket: {\n        value: null,\n        writable: true\n      },\n      _unhandledRequests: {\n        value: []\n      },\n      _url: {\n        value: rpcUrl\n      }\n    });\n    _this._handleSocketClose = _this._handleSocketClose.bind(_assertThisInitialized(_this));\n    _this._handleSocketMessage = _this._handleSocketMessage.bind(_assertThisInitialized(_this));\n    _this._handleSocketOpen = _this._handleSocketOpen.bind(_assertThisInitialized(_this)); // Called when a backoff timeout has finished. Time to try reconnecting.\n\n    _this._backoff.on('ready', function () {\n      _this._openSocket();\n    });\n\n    _this._openSocket();\n\n    return _this;\n  }\n\n  _createClass(WebsocketSubprovider, [{\n    key: \"handleRequest\",\n    value: function handleRequest(payload, next, end) {\n      if (!this._socket || this._socket.readyState !== WebSocket.OPEN) {\n        this._unhandledRequests.push(Array.from(arguments));\n\n        this._log('Socket not open. Request queued.');\n\n        return;\n      }\n\n      this._pendingRequests.set(payload.id, [payload, end]);\n\n      var newPayload = createPayload(payload);\n      delete newPayload.origin;\n\n      this._socket.send(JSON.stringify(newPayload));\n\n      this._log(\"Sent: \".concat(newPayload.method, \" #\").concat(newPayload.id));\n    }\n  }, {\n    key: \"_handleSocketClose\",\n    value: function _handleSocketClose(_ref2) {\n      var reason = _ref2.reason,\n          code = _ref2.code;\n\n      this._log(\"Socket closed, code \".concat(code, \" (\").concat(reason || 'no reason', \")\")); // If the socket has been open for longer than 5 seconds, reset the backoff\n\n\n      if (this._connectTime && Date.now() - this._connectTime > 5000) {\n        this._backoff.reset();\n      }\n\n      this._socket.removeEventListener('close', this._handleSocketClose);\n\n      this._socket.removeEventListener('message', this._handleSocketMessage);\n\n      this._socket.removeEventListener('open', this._handleSocketOpen);\n\n      this._socket = null;\n\n      this._backoff.backoff();\n    }\n  }, {\n    key: \"_handleSocketMessage\",\n    value: function _handleSocketMessage(message) {\n      var payload;\n\n      try {\n        payload = JSON.parse(message.data);\n      } catch (e) {\n        this._log('Received a message that is not valid JSON:', payload);\n\n        return;\n      } // check if server-sent notification\n\n\n      if (payload.id === undefined) {\n        return this.engine.emit('data', null, payload);\n      } // ignore if missing\n\n\n      if (!this._pendingRequests.has(payload.id)) {\n        return;\n      } // retrieve payload + arguments\n\n\n      var _this$_pendingRequest = this._pendingRequests.get(payload.id),\n          _this$_pendingRequest2 = _slicedToArray(_this$_pendingRequest, 2),\n          originalReq = _this$_pendingRequest2[0],\n          end = _this$_pendingRequest2[1];\n\n      this._pendingRequests.delete(payload.id);\n\n      this._log(\"Received: \".concat(originalReq.method, \" #\").concat(payload.id)); // forward response\n\n\n      if (payload.error) {\n        return end(new Error(payload.error.message));\n      }\n\n      end(null, payload.result);\n    }\n  }, {\n    key: \"_handleSocketOpen\",\n    value: function _handleSocketOpen() {\n      var _this2 = this;\n\n      this._log('Socket open.');\n\n      this._connectTime = Date.now(); // Any pending requests need to be resent because our session was lost\n      // and will not get responses for them in our new session.\n\n      this._pendingRequests.forEach(function (_ref3) {\n        var _ref4 = _slicedToArray(_ref3, 2),\n            payload = _ref4[0],\n            end = _ref4[1];\n\n        _this2._unhandledRequests.push([payload, null, end]);\n      });\n\n      this._pendingRequests.clear();\n\n      var unhandledRequests = this._unhandledRequests.splice(0, this._unhandledRequests.length);\n\n      unhandledRequests.forEach(function (request) {\n        _this2.handleRequest.apply(_this2, request);\n      });\n    }\n  }, {\n    key: \"_openSocket\",\n    value: function _openSocket() {\n      this._log('Opening socket...');\n\n      this._socket = new WebSocket(this._url, [], this._origin ? {\n        headers: {\n          origin: this._origin\n        }\n      } : {});\n\n      this._socket.addEventListener('close', this._handleSocketClose);\n\n      this._socket.addEventListener('message', this._handleSocketMessage);\n\n      this._socket.addEventListener('open', this._handleSocketOpen);\n    }\n  }]);\n\n  return WebsocketSubprovider;\n}(Subprovider); // multiple inheritance\n\n\nObject.assign(WebsocketSubprovider.prototype, EventEmitter.prototype);\nmodule.exports = WebsocketSubprovider;","map":{"version":3,"sources":["C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/burner-provider/node_modules/web3-provider-engine/subproviders/websocket.js"],"names":["Backoff","require","EventEmitter","inherits","WebSocket","global","Subprovider","createPayload","WebsocketSubprovider","rpcUrl","debug","origin","call","Object","defineProperties","_backoff","value","exponential","randomisationFactor","maxDelay","_connectTime","writable","_log","args","console","info","apply","_origin","_pendingRequests","Map","_socket","_unhandledRequests","_url","_handleSocketClose","bind","_handleSocketMessage","_handleSocketOpen","on","_openSocket","payload","next","end","readyState","OPEN","push","Array","from","arguments","set","id","newPayload","send","JSON","stringify","method","reason","code","Date","now","reset","removeEventListener","backoff","message","parse","data","e","undefined","engine","emit","has","get","originalReq","delete","error","Error","result","forEach","clear","unhandledRequests","splice","length","request","handleRequest","headers","addEventListener","assign","prototype","module","exports"],"mappings":"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","sourcesContent":["const Backoff = require('backoff')\nconst EventEmitter = require('events')\nconst inherits = require('util').inherits\nconst WebSocket = global.WebSocket || require('ws')\nconst Subprovider = require('./subprovider')\nconst createPayload = require('../util/create-payload')\n\nclass WebsocketSubprovider\n extends Subprovider {\n  constructor({ rpcUrl, debug, origin }) {\n    super()\n\n    // inherit from EventEmitter\n    EventEmitter.call(this)\n\n    Object.defineProperties(this, {\n      _backoff: {\n        value: Backoff.exponential({\n          randomisationFactor: 0.2,\n          maxDelay: 5000\n        })\n      },\n      _connectTime: {\n        value: null,\n        writable: true\n      },\n      _log: {\n        value: debug\n          ? (...args) => console.info.apply(console, ['[WSProvider]', ...args])\n          : () => { }\n      },\n      _origin: {\n        value: origin\n      },\n      _pendingRequests: {\n        value: new Map()\n      },\n      _socket: {\n        value: null,\n        writable: true\n      },\n      _unhandledRequests: {\n        value: []\n      },\n      _url: {\n        value: rpcUrl\n      }\n    })\n\n    this._handleSocketClose = this._handleSocketClose.bind(this)\n    this._handleSocketMessage = this._handleSocketMessage.bind(this)\n    this._handleSocketOpen = this._handleSocketOpen.bind(this)\n\n    // Called when a backoff timeout has finished. Time to try reconnecting.\n    this._backoff.on('ready', () => {\n      this._openSocket()\n    })\n\n    this._openSocket()\n  }\n\n  handleRequest(payload, next, end) {\n    if (!this._socket || this._socket.readyState !== WebSocket.OPEN) {\n      this._unhandledRequests.push(Array.from(arguments))\n      this._log('Socket not open. Request queued.')\n      return\n    }\n\n    this._pendingRequests.set(payload.id, [payload, end])\n\n    const newPayload = createPayload(payload)\n    delete newPayload.origin\n\n    this._socket.send(JSON.stringify(newPayload))\n    this._log(`Sent: ${newPayload.method} #${newPayload.id}`)\n  }\n\n  _handleSocketClose({ reason, code }) {\n    this._log(`Socket closed, code ${code} (${reason || 'no reason'})`)\n    // If the socket has been open for longer than 5 seconds, reset the backoff\n    if (this._connectTime && Date.now() - this._connectTime > 5000) {\n      this._backoff.reset()\n    }\n\n    this._socket.removeEventListener('close', this._handleSocketClose)\n    this._socket.removeEventListener('message', this._handleSocketMessage)\n    this._socket.removeEventListener('open', this._handleSocketOpen)\n\n    this._socket = null\n    this._backoff.backoff()\n  }\n\n  _handleSocketMessage(message) {\n    let payload\n\n    try {\n      payload = JSON.parse(message.data)\n    } catch (e) {\n      this._log('Received a message that is not valid JSON:', payload)\n      return\n    }\n\n    // check if server-sent notification\n    if (payload.id === undefined) {\n      return this.engine.emit('data', null, payload)\n    }\n\n    // ignore if missing\n    if (!this._pendingRequests.has(payload.id)) {\n      return\n    }\n\n    // retrieve payload + arguments\n    const [originalReq, end] = this._pendingRequests.get(payload.id)\n    this._pendingRequests.delete(payload.id)\n\n    this._log(`Received: ${originalReq.method} #${payload.id}`)\n\n    // forward response\n    if (payload.error) {\n      return end(new Error(payload.error.message))\n    }\n    end(null, payload.result)\n  }\n\n  _handleSocketOpen() {\n    this._log('Socket open.')\n    this._connectTime = Date.now()\n\n    // Any pending requests need to be resent because our session was lost\n    // and will not get responses for them in our new session.\n    this._pendingRequests.forEach(([payload, end]) => {\n      this._unhandledRequests.push([payload, null, end])\n    })\n    this._pendingRequests.clear()\n\n    const unhandledRequests = this._unhandledRequests.splice(0, this._unhandledRequests.length)\n    unhandledRequests.forEach(request => {\n      this.handleRequest.apply(this, request)\n    })\n  }\n\n  _openSocket() {\n    this._log('Opening socket...')\n    this._socket = new WebSocket(this._url, [], this._origin ? {headers:{origin: this._origin}} : {})\n    this._socket.addEventListener('close', this._handleSocketClose)\n    this._socket.addEventListener('message', this._handleSocketMessage)\n    this._socket.addEventListener('open', this._handleSocketOpen)\n  }\n}\n\n// multiple inheritance\nObject.assign(WebsocketSubprovider.prototype, EventEmitter.prototype)\n\nmodule.exports = WebsocketSubprovider\n"]},"metadata":{},"sourceType":"script"}