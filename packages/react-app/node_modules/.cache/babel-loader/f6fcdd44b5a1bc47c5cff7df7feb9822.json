{"ast":null,"code":"\"use strict\"; // Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\n\nvar _classCallCheck = require(\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Session = void 0;\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar operators_1 = require(\"rxjs/operators\");\n\nvar util_1 = require(\"../util\");\n\nvar js_sha256_1 = require(\"js-sha256\");\n\nvar STORAGE_KEY_SESSION_ID = \"session:id\";\nvar STORAGE_KEY_SESSION_SECRET = \"session:secret\";\nvar STORAGE_KEY_SESSION_LINKED = \"session:linked\";\n\nvar Session = /*#__PURE__*/function () {\n  function Session(storage, id, secret, linked) {\n    _classCallCheck(this, Session);\n\n    this._storage = storage;\n    this._id = id || (0, util_1.randomBytesHex)(16);\n    this._secret = secret || (0, util_1.randomBytesHex)(32);\n    var hash = js_sha256_1.sha256.create();\n    hash.update(\"\".concat(this._id, \", \").concat(this._secret, \" WalletLink\"));\n    this._key = hash.hex();\n    this._linked = !!linked;\n  }\n\n  _createClass(Session, [{\n    key: \"id\",\n    get: function get() {\n      return this._id;\n    }\n  }, {\n    key: \"secret\",\n    get: function get() {\n      return this._secret;\n    }\n  }, {\n    key: \"key\",\n    get: function get() {\n      return this._key;\n    }\n  }, {\n    key: \"linked\",\n    get: function get() {\n      return this._linked;\n    },\n    set: function set(val) {\n      this._linked = val;\n      this.persistLinked();\n    }\n  }, {\n    key: \"save\",\n    value: function save() {\n      this._storage.setItem(STORAGE_KEY_SESSION_ID, this._id);\n\n      this._storage.setItem(STORAGE_KEY_SESSION_SECRET, this._secret);\n\n      this.persistLinked();\n      return this;\n    }\n  }, {\n    key: \"persistLinked\",\n    value: function persistLinked() {\n      this._storage.setItem(STORAGE_KEY_SESSION_LINKED, this._linked ? \"1\" : \"0\");\n    }\n  }], [{\n    key: \"load\",\n    value: function load(storage) {\n      var id = storage.getItem(STORAGE_KEY_SESSION_ID);\n      var linked = storage.getItem(STORAGE_KEY_SESSION_LINKED);\n      var secret = storage.getItem(STORAGE_KEY_SESSION_SECRET);\n\n      if (id && secret) {\n        return new Session(storage, id, secret, linked === \"1\");\n      }\n\n      return null;\n    }\n  }, {\n    key: \"clear\",\n    value: function clear(storage) {\n      storage.removeItem(STORAGE_KEY_SESSION_SECRET);\n      storage.removeItem(STORAGE_KEY_SESSION_ID);\n      storage.removeItem(STORAGE_KEY_SESSION_LINKED);\n    }\n  }, {\n    key: \"persistedSessionIdChange$\",\n    get: function get() {\n      return (0, rxjs_1.fromEvent)(window, \"storage\").pipe((0, operators_1.filter)(function (evt) {\n        return evt.key === STORAGE_KEY_SESSION_ID;\n      }), (0, operators_1.map)(function (evt) {\n        return {\n          oldValue: evt.oldValue || null,\n          newValue: evt.newValue || null\n        };\n      }));\n    }\n    /**\n     * Takes in a session ID and returns the sha256 hash of it.\n     * @param sessionId session ID\n     */\n\n  }, {\n    key: \"hash\",\n    value: function hash(sessionId) {\n      var hash = js_sha256_1.sha256.create();\n      return hash.update(sessionId).hex();\n    }\n  }]);\n\n  return Session;\n}();\n\nexports.Session = Session;","map":{"version":3,"sources":["C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/walletlink/dist/relay/Session.js"],"names":["Object","defineProperty","exports","value","Session","rxjs_1","require","operators_1","util_1","js_sha256_1","STORAGE_KEY_SESSION_ID","STORAGE_KEY_SESSION_SECRET","STORAGE_KEY_SESSION_LINKED","storage","id","secret","linked","_storage","_id","randomBytesHex","_secret","hash","sha256","create","update","_key","hex","_linked","val","persistLinked","setItem","getItem","removeItem","fromEvent","window","pipe","filter","evt","key","map","oldValue","newValue","sessionId"],"mappings":"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","sourcesContent":["\"use strict\";\n// Copyright (c) 2018-2020 WalletLink.org <https://www.walletlink.org/>\n// Copyright (c) 2018-2020 Coinbase, Inc. <https://www.coinbase.com/>\n// Licensed under the Apache License, version 2.0\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Session = void 0;\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst util_1 = require(\"../util\");\nconst js_sha256_1 = require(\"js-sha256\");\nconst STORAGE_KEY_SESSION_ID = \"session:id\";\nconst STORAGE_KEY_SESSION_SECRET = \"session:secret\";\nconst STORAGE_KEY_SESSION_LINKED = \"session:linked\";\nclass Session {\n    constructor(storage, id, secret, linked) {\n        this._storage = storage;\n        this._id = id || (0, util_1.randomBytesHex)(16);\n        this._secret = secret || (0, util_1.randomBytesHex)(32);\n        const hash = js_sha256_1.sha256.create();\n        hash.update(`${this._id}, ${this._secret} WalletLink`);\n        this._key = hash.hex();\n        this._linked = !!linked;\n    }\n    static load(storage) {\n        const id = storage.getItem(STORAGE_KEY_SESSION_ID);\n        const linked = storage.getItem(STORAGE_KEY_SESSION_LINKED);\n        const secret = storage.getItem(STORAGE_KEY_SESSION_SECRET);\n        if (id && secret) {\n            return new Session(storage, id, secret, linked === \"1\");\n        }\n        return null;\n    }\n    static clear(storage) {\n        storage.removeItem(STORAGE_KEY_SESSION_SECRET);\n        storage.removeItem(STORAGE_KEY_SESSION_ID);\n        storage.removeItem(STORAGE_KEY_SESSION_LINKED);\n    }\n    static get persistedSessionIdChange$() {\n        return (0, rxjs_1.fromEvent)(window, \"storage\").pipe((0, operators_1.filter)(evt => evt.key === STORAGE_KEY_SESSION_ID), (0, operators_1.map)(evt => ({\n            oldValue: evt.oldValue || null,\n            newValue: evt.newValue || null\n        })));\n    }\n    /**\n     * Takes in a session ID and returns the sha256 hash of it.\n     * @param sessionId session ID\n     */\n    static hash(sessionId) {\n        const hash = js_sha256_1.sha256.create();\n        return hash.update(sessionId).hex();\n    }\n    get id() {\n        return this._id;\n    }\n    get secret() {\n        return this._secret;\n    }\n    get key() {\n        return this._key;\n    }\n    get linked() {\n        return this._linked;\n    }\n    set linked(val) {\n        this._linked = val;\n        this.persistLinked();\n    }\n    save() {\n        this._storage.setItem(STORAGE_KEY_SESSION_ID, this._id);\n        this._storage.setItem(STORAGE_KEY_SESSION_SECRET, this._secret);\n        this.persistLinked();\n        return this;\n    }\n    persistLinked() {\n        this._storage.setItem(STORAGE_KEY_SESSION_LINKED, this._linked ? \"1\" : \"0\");\n    }\n}\nexports.Session = Session;\n"]},"metadata":{},"sourceType":"script"}