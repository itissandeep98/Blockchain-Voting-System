{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\KINSHUK\\\\Desktop\\\\ETH\\\\qd-off-chain-voters-and-candidates\\\\packages\\\\react-app\\\\src\\\\views\\\\QuadraticDiplomacyVote.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState, useMemo } from \"react\";\nimport { Button, Checkbox, Divider, Space, List, Steps, Typography, Badge, Spin, Row, Col } from \"antd\";\nimport { SmileTwoTone, LikeTwoTone, CheckCircleTwoTone, MinusOutlined, PlusOutlined } from \"@ant-design/icons\";\nimport { Address } from \"../components\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst {\n  Title,\n  Text\n} = Typography;\n\nconst axios = require(\"axios\");\n\nexport default function QuadraticDiplomacyVote(_ref) {\n  _s();\n\n  let {\n    contributorEntries,\n    isVoter,\n    mainnetProvider,\n    currentDistribution,\n    address,\n    userSigner,\n    serverUrl\n  } = _ref;\n  const [selectedContributors, setSelectedContributors] = useState({});\n  const [currentStep, setCurrentStep] = useState(1);\n  const [spentVoteTokens, setSpentVoteTokens] = useState(0);\n  const [isSendingTx, setIsSendingTx] = useState(false);\n\n  if (Object.keys(selectedContributors).length === 0 && currentDistribution.id) {\n    setSelectedContributors(currentDistribution.candidates.reduce((entries, current) => {\n      entries[current] = 0;\n      return entries;\n    }, {}));\n  }\n\n  const contributors = useMemo(() => currentDistribution.id && currentDistribution.candidates.reduce((entries, current) => {\n    entries[current] = 0;\n    return entries;\n  }, {}), [currentDistribution.id]);\n  const remainingVoteTokens = useMemo(() => currentDistribution.id && currentDistribution.voteAllocation - spentVoteTokens, [currentDistribution.id, spentVoteTokens]);\n\n  if (!isVoter) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        border: \"1px solid\",\n        padding: \"40px\",\n        width: 800,\n        margin: \"auto\",\n        marginTop: 64,\n        textAlign: \"left\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(Title, {\n        level: 4,\n        style: {\n          fontFamily: \"Space Mono\"\n        },\n        children: \"Access denied\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"You are not part of the voters of this election.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 7\n    }, this);\n  }\n\n  const handleContributorVote = (e, op, clickedContributorAddress) => {\n    // adjust available vote tokens\n    setSpentVoteTokens(prevSpentVoteTokens => op === \"add\" ? prevSpentVoteTokens + 1 : prevSpentVoteTokens - 1); // update contributor vote tokens\n\n    setSelectedContributors(prevSelectedContributors => ({ ...prevSelectedContributors,\n      [clickedContributorAddress]: op === \"add\" ? Math.min(prevSelectedContributors[clickedContributorAddress] + 1, currentDistribution.voteAllocation) : Math.max(prevSelectedContributors[clickedContributorAddress] - 1, 0)\n    }));\n  };\n\n  const handleSubmitVotes = async () => {\n    const wallets = [];\n    const amounts = [];\n    const sortedVotes = Object.keys(selectedContributors).sort();\n    const message = \"qdip-vote-\" + currentDistribution.id + address + sortedVotes.join() + sortedVotes.map(voter => selectedContributors[voter]).join();\n    const signature = await userSigner.signMessage(message);\n    setIsSendingTx(true);\n    axios.post(serverUrl + \"distributions/\" + currentDistribution.id + \"/vote\", {\n      address: address,\n      votes: selectedContributors,\n      signature: signature\n    }).then(response => {\n      console.log(response);\n      setIsSendingTx(false);\n      setSpentVoteTokens(0);\n      setCurrentStep(2);\n    }).catch(e => {\n      console.log(\"Error on vote\");\n      setIsSendingTx(false);\n    });\n  };\n\n  if (!currentDistribution.id) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        border: \"1px solid #cccccc\",\n        padding: 16,\n        width: 800,\n        margin: \"auto\",\n        marginTop: 64\n      },\n      children: /*#__PURE__*/_jsxDEV(Title, {\n        level: 4,\n        children: \"No Current Distribution\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this);\n  }\n\n  if (currentDistribution.id && currentStep != 2 && currentDistribution.votes && currentDistribution.votes[address]) {\n    setSelectedContributors(currentDistribution.votes[address]);\n    setCurrentStep(2);\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      border: \"1px solid\",\n      padding: \"40px\",\n      width: 800,\n      margin: \"auto\",\n      marginTop: 64,\n      textAlign: \"left\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(Title, {\n      level: 3,\n      children: [\"Distribution \", currentDistribution.id]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Divider, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }, this), currentStep === 1 ? /*#__PURE__*/_jsxDEV(List, {\n      size: \"large\",\n      itemLayout: \"horizontal\",\n      style: {\n        width: \"600px\",\n        margin: \"0 auto\"\n      },\n      header: /*#__PURE__*/_jsxDEV(Space, {\n        direction: \"vertical\",\n        children: [/*#__PURE__*/_jsxDEV(Title, {\n          level: 4,\n          style: {\n            fontFamily: \"Space Mono\"\n          },\n          children: \"Allocate votes\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Title, {\n          level: 5,\n          children: [\"Remaining vote tokens:\\xA0\\xA0\", /*#__PURE__*/_jsxDEV(Badge, {\n            showZero: true,\n            overflowCount: 1000,\n            count: remainingVoteTokens,\n            style: {\n              backgroundColor: \"#52c41a\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 136,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 13\n      }, this),\n      footer: /*#__PURE__*/_jsxDEV(Row, {\n        justify: \"end\",\n        children: !isSendingTx ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            type: \"primary\",\n            onClick: handleSubmitVotes,\n            children: \"Commit votes\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 149,\n            columnNumber: 19\n          }, this)\n        }, void 0, false) : /*#__PURE__*/_jsxDEV(Spin, {\n          size: \"small\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 13\n      }, this),\n      dataSource: Object.entries(selectedContributors),\n      renderItem: _ref2 => {\n        let [contributorAddress, contributor] = _ref2;\n        return /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Badge.Ribbon, {\n            showZero: true,\n            overflowCount: 1000,\n            text: /*#__PURE__*/_jsxDEV(Title, {\n              level: 5,\n              children: [contributor, \" \"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 164,\n              columnNumber: 23\n            }, this),\n            style: {\n              backgroundColor: contributor ? \"#eb2f96\" : \"grey\",\n              height: 24,\n              width: 30,\n              marginRight: -5\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(List.Item, {\n            extra: /*#__PURE__*/_jsxDEV(Button.Group, {\n              children: [/*#__PURE__*/_jsxDEV(Button, {\n                danger: true,\n                ghost: true,\n                onClick: e => handleContributorVote(e, \"remove\", contributorAddress),\n                disabled: !contributor,\n                children: /*#__PURE__*/_jsxDEV(MinusOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 182,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 176,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                type: \"primary\",\n                ghost: true,\n                onClick: e => handleContributorVote(e, \"add\", contributorAddress),\n                disabled: !remainingVoteTokens,\n                children: /*#__PURE__*/_jsxDEV(PlusOutlined, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 190,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 184,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 175,\n              columnNumber: 19\n            }, this),\n            children: /*#__PURE__*/_jsxDEV(List.Item.Meta, {\n              avatar: /*#__PURE__*/_jsxDEV(Address, {\n                address: contributorAddress,\n                fontSize: 16,\n                size: \"short\",\n                ensProvider: mainnetProvider\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 197,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 195,\n              columnNumber: 17\n            }, this)\n          }, contributorAddress, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 9\n    }, this) : currentStep === 2 && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Title, {\n        level: 3,\n        style: {\n          fontFamily: \"Space Mono\"\n        },\n        children: \"Thank you for voting.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"The allocation to this workstream will be informed by your votes.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Title, {\n        level: 5,\n        style: {\n          marginTop: \"24px\"\n        },\n        children: \"Your votes:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 13\n      }, this), Object.entries(selectedContributors).map(_ref3 => {\n        let [contributorAddress, voteTokens] = _ref3;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(Address, {\n            address: contributorAddress,\n            fontSize: 16,\n            size: \"short\",\n            ensProvider: mainnetProvider\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 212,\n            columnNumber: 17\n          }, this), \" (\", /*#__PURE__*/_jsxDEV(Text, {\n            children: voteTokens\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 17\n          }, this), \")\"]\n        }, contributorAddress, true, {\n          fileName: _jsxFileName,\n          lineNumber: 211,\n          columnNumber: 15\n        }, this);\n      })]\n    }, void 0, true)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 123,\n    columnNumber: 5\n  }, this);\n}\n\n_s(QuadraticDiplomacyVote, \"EzapcwLCAP2fJkNBB9p6r5w6xpw=\");\n\n_c = QuadraticDiplomacyVote;\n\nvar _c;\n\n$RefreshReg$(_c, \"QuadraticDiplomacyVote\");","map":{"version":3,"sources":["C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/packages/react-app/src/views/QuadraticDiplomacyVote.jsx"],"names":["React","useEffect","useState","useMemo","Button","Checkbox","Divider","Space","List","Steps","Typography","Badge","Spin","Row","Col","SmileTwoTone","LikeTwoTone","CheckCircleTwoTone","MinusOutlined","PlusOutlined","Address","Title","Text","axios","require","QuadraticDiplomacyVote","contributorEntries","isVoter","mainnetProvider","currentDistribution","address","userSigner","serverUrl","selectedContributors","setSelectedContributors","currentStep","setCurrentStep","spentVoteTokens","setSpentVoteTokens","isSendingTx","setIsSendingTx","Object","keys","length","id","candidates","reduce","entries","current","contributors","remainingVoteTokens","voteAllocation","border","padding","width","margin","marginTop","textAlign","fontFamily","handleContributorVote","e","op","clickedContributorAddress","prevSpentVoteTokens","prevSelectedContributors","Math","min","max","handleSubmitVotes","wallets","amounts","sortedVotes","sort","message","join","map","voter","signature","signMessage","post","votes","then","response","console","log","catch","backgroundColor","contributorAddress","contributor","height","marginRight","voteTokens"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useMemo } from \"react\";\r\nimport { Button, Checkbox, Divider, Space, List, Steps, Typography, Badge, Spin, Row, Col } from \"antd\";\r\nimport { SmileTwoTone, LikeTwoTone, CheckCircleTwoTone, MinusOutlined, PlusOutlined } from \"@ant-design/icons\";\r\nimport { Address } from \"../components\";\r\nconst { Title, Text } = Typography;\r\nconst axios = require(\"axios\");\r\n\r\nexport default function QuadraticDiplomacyVote({\r\n  contributorEntries,\r\n  isVoter,\r\n  mainnetProvider,\r\n  currentDistribution,\r\n  address,\r\n  userSigner,\r\n  serverUrl,\r\n}) {\r\n  const [selectedContributors, setSelectedContributors] = useState({});\r\n  const [currentStep, setCurrentStep] = useState(1);\r\n  const [spentVoteTokens, setSpentVoteTokens] = useState(0);\r\n  const [isSendingTx, setIsSendingTx] = useState(false);\r\n\r\n  if (Object.keys(selectedContributors).length === 0 && currentDistribution.id) {\r\n    setSelectedContributors(\r\n      currentDistribution.candidates.reduce((entries, current) => {\r\n        entries[current] = 0;\r\n        return entries;\r\n      }, {}),\r\n    );\r\n  }\r\n\r\n  const contributors = useMemo(\r\n    () =>\r\n      currentDistribution.id &&\r\n      currentDistribution.candidates.reduce((entries, current) => {\r\n        entries[current] = 0;\r\n        return entries;\r\n      }, {}),\r\n    [currentDistribution.id],\r\n  );\r\n\r\n  const remainingVoteTokens = useMemo(\r\n    () => currentDistribution.id && currentDistribution.voteAllocation - spentVoteTokens,\r\n    [currentDistribution.id, spentVoteTokens],\r\n  );\r\n\r\n  if (!isVoter) {\r\n    return (\r\n      <div style={{ border: \"1px solid\", padding: \"40px\", width: 800, margin: \"auto\", marginTop: 64, textAlign: \"left\" }}>\r\n        <Title level={4} style={{ fontFamily: \"Space Mono\" }}>Access denied</Title>\r\n        <p>You are not part of the voters of this election.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handleContributorVote = (e, op, clickedContributorAddress) => {\r\n    // adjust available vote tokens\r\n    setSpentVoteTokens(prevSpentVoteTokens => (op === \"add\" ? prevSpentVoteTokens + 1 : prevSpentVoteTokens - 1));\r\n\r\n    // update contributor vote tokens\r\n    setSelectedContributors(prevSelectedContributors => ({\r\n      ...prevSelectedContributors,\r\n      [clickedContributorAddress]:\r\n        op === \"add\"\r\n          ? Math.min(prevSelectedContributors[clickedContributorAddress] + 1, currentDistribution.voteAllocation)\r\n          : Math.max(prevSelectedContributors[clickedContributorAddress] - 1, 0),\r\n    }));\r\n  };\r\n\r\n  const handleSubmitVotes = async () => {\r\n    const wallets = [];\r\n    const amounts = [];\r\n\r\n    const sortedVotes = Object.keys(selectedContributors).sort();\r\n\r\n    const message =\r\n      \"qdip-vote-\" +\r\n      currentDistribution.id +\r\n      address +\r\n      sortedVotes.join() +\r\n      sortedVotes.map(voter => selectedContributors[voter]).join();\r\n\r\n    const signature = await userSigner.signMessage(message);\r\n\r\n    setIsSendingTx(true);\r\n\r\n    axios\r\n      .post(serverUrl + \"distributions/\" + currentDistribution.id + \"/vote\", {\r\n        address: address,\r\n        votes: selectedContributors,\r\n        signature: signature,\r\n      })\r\n      .then(response => {\r\n        console.log(response);\r\n        setIsSendingTx(false);\r\n        setSpentVoteTokens(0);\r\n        setCurrentStep(2);\r\n      })\r\n      .catch(e => {\r\n        console.log(\"Error on vote\");\r\n        setIsSendingTx(false);\r\n      });\r\n  };\r\n\r\n  if (!currentDistribution.id) {\r\n    return (\r\n      <div style={{ border: \"1px solid #cccccc\", padding: 16, width: 800, margin: \"auto\", marginTop: 64 }}>\r\n        <Title level={4}>No Current Distribution</Title>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (\r\n    currentDistribution.id &&\r\n    currentStep != 2 &&\r\n    currentDistribution.votes &&\r\n    currentDistribution.votes[address]\r\n  ) {\r\n    setSelectedContributors(currentDistribution.votes[address]);\r\n    setCurrentStep(2);\r\n  }\r\n\r\n  return (\r\n    <div style={{ border: \"1px solid\", padding: \"40px\", width: 800, margin: \"auto\", marginTop: 64, textAlign: \"left\" }}>\r\n      <Title level={3}>Distribution {currentDistribution.id}</Title>\r\n      <Divider />\r\n      {currentStep === 1 ? (\r\n        <List\r\n          size=\"large\"\r\n          itemLayout=\"horizontal\"\r\n          style={{ width: \"600px\", margin: \"0 auto\" }}\r\n          header={\r\n            <Space direction=\"vertical\">\r\n              <Title level={4} style={{ fontFamily: \"Space Mono\" }}>Allocate votes</Title>\r\n              <Title level={5}>\r\n                Remaining vote tokens:&nbsp;&nbsp;\r\n                <Badge\r\n                  showZero\r\n                  overflowCount={1000}\r\n                  count={remainingVoteTokens}\r\n                  style={{ backgroundColor: \"#52c41a\" }}\r\n                />\r\n              </Title>\r\n            </Space>\r\n          }\r\n          footer={\r\n            <Row justify=\"end\">\r\n              {!isSendingTx ? (\r\n                <>\r\n                  <Button type=\"primary\" onClick={handleSubmitVotes}>\r\n                    Commit votes\r\n                  </Button>\r\n                </>\r\n              ) : (\r\n                <Spin size=\"small\" />\r\n              )}\r\n            </Row>\r\n          }\r\n          dataSource={Object.entries(selectedContributors)}\r\n          renderItem={([contributorAddress, contributor]) => (\r\n            <>\r\n              <Badge.Ribbon\r\n                showZero\r\n                overflowCount={1000}\r\n                text={<Title level={5}>{contributor} </Title>}\r\n                style={{\r\n                  backgroundColor: contributor ? \"#eb2f96\" : \"grey\",\r\n                  height: 24,\r\n                  width: 30,\r\n                  marginRight: -5,\r\n                }}\r\n              />\r\n              <List.Item\r\n                key={contributorAddress}\r\n                extra={\r\n                  <Button.Group>\r\n                    <Button\r\n                      danger\r\n                      ghost\r\n                      onClick={e => handleContributorVote(e, \"remove\", contributorAddress)}\r\n                      disabled={!contributor}\r\n                    >\r\n                      <MinusOutlined />\r\n                    </Button>\r\n                    <Button\r\n                      type=\"primary\"\r\n                      ghost\r\n                      onClick={e => handleContributorVote(e, \"add\", contributorAddress)}\r\n                      disabled={!remainingVoteTokens}\r\n                    >\r\n                      <PlusOutlined />\r\n                    </Button>\r\n                  </Button.Group>\r\n                }\r\n              >\r\n                <List.Item.Meta\r\n                  avatar={\r\n                    <Address address={contributorAddress} fontSize={16} size=\"short\" ensProvider={mainnetProvider} />\r\n                  }\r\n                />\r\n              </List.Item>\r\n            </>\r\n          )}\r\n        />\r\n      ) : (\r\n        currentStep === 2 && (\r\n          <>\r\n            <Title level={3} style={{ fontFamily: \"Space Mono\" }}>Thank you for voting.</Title>\r\n            <p>The allocation to this workstream will be informed by your votes.</p>\r\n            <Title level={5} style={{ marginTop: \"24px\" }}>Your votes:</Title>\r\n            {Object.entries(selectedContributors).map(([contributorAddress, voteTokens]) => (\r\n              <div key={contributorAddress}>\r\n                <Address address={contributorAddress} fontSize={16} size=\"short\" ensProvider={mainnetProvider} /> (\r\n                <Text>{voteTokens}</Text>)\r\n              </div>\r\n            ))}\r\n          </>\r\n        )\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}