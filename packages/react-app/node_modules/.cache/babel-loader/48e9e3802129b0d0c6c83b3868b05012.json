{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import{Form,Input,Divider,Button,Typography,Row,Col,Spin}from\"antd\";import{PlusOutlined}from\"@ant-design/icons\";import{DeleteOutlined}from\"@ant-design/icons\";import{AddressInput}from\"../components\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Title=Typography.Title;var axios=require(\"axios\");var _require=require(\"ethers\"),ethers=_require.ethers;export default function QuadraticDiplomacyCreate(_ref){var mainnetProvider=_ref.mainnetProvider,serverUrl=_ref.serverUrl,address=_ref.address,userSigner=_ref.userSigner,currentDistribution=_ref.currentDistribution,setCurrentDistribution=_ref.setCurrentDistribution,isAdmin=_ref.isAdmin;var _useState=useState([\"\"]),_useState2=_slicedToArray(_useState,2),voters=_useState2[0],setVoters=_useState2[1];var _useState3=useState([\"\"]),_useState4=_slicedToArray(_useState3,2),candidates=_useState4[0],setCandidates=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),voteAllocation=_useState6[0],setVoteAllocation=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isSendingTx=_useState8[0],setIsSendingTx=_useState8[1];var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var handleAddVoters=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var text,addresses;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return navigator.clipboard.readText();case 2:text=_context.sent;addresses=text.split(\",\");if(voters.length===1&&voters[0]===\"\"){setVoters([]);}addresses.forEach(function(voteAddress){try{var voteAddressWithChecksum=ethers.utils.getAddress(voteAddress);if(!voters.includes(voteAddressWithChecksum)){setVoters(function(prevVoters){return[].concat(_toConsumableArray(prevVoters),[voteAddressWithChecksum]);});}}catch(error){console.log(\"Error parsing address \",voteAddress);console.log(error);}});case 6:case\"end\":return _context.stop();}}},_callee);}));return function handleAddVoters(){return _ref2.apply(this,arguments);};}();var handleAddCandidates=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var text,addresses;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return navigator.clipboard.readText();case 2:text=_context2.sent;addresses=text.split(\",\");if(voters.length===1&&voters[0]===\"\"){setVoters([]);}addresses.forEach(function(candidateAddress){try{var candidateAddressWithChecksum=ethers.utils.getAddress(candidateAddress);if(!candidates.includes(candidateAddressWithChecksum)){setCandidates(function(prevCandidates){return[].concat(_toConsumableArray(prevCandidates),[candidateAddressWithChecksum]);});}}catch(error){console.log(\"Error parsing address \",candidateAddress);console.log(error);}});case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function handleAddCandidates(){return _ref3.apply(this,arguments);};}();var handleSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var filteredVoters,filteredCandidates,message,signature;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:// ToDo. Check if addresses are valid.\nsetIsSendingTx(true);filteredVoters=voters.filter(function(voter){return voter;});filteredCandidates=candidates.filter(function(voter){return voter;});message=\"qdip-creation-\"+address;console.log(\"Message:\"+message);_context3.next=7;return userSigner.signMessage(message);case 7:signature=_context3.sent;axios.post(serverUrl+\"distributions\",{address:address,voteAllocation:voteAllocation,members:filteredVoters,candidates:filteredCandidates,signature:signature}).then(function(response){console.log(response);setCurrentDistribution(response);setVoters([\"\"]);setVoteAllocation(0);form.resetFields();setIsSendingTx(false);}).catch(function(e){console.log(\"Error on distributions post\");});case 9:case\"end\":return _context3.stop();}}},_callee3);}));return function handleSubmit(){return _ref4.apply(this,arguments);};}();if(!isAdmin){return/*#__PURE__*/_jsxs(\"div\",{style:{border:\"1px solid #cccccc\",padding:16,width:800,margin:\"auto\",marginTop:64},children:[/*#__PURE__*/_jsx(Title,{level:4,children:\"Access denied\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Only admins can create distributions.\"})]});}if(currentDistribution.id){return/*#__PURE__*/_jsx(\"div\",{style:{border:\"1px solid #cccccc\",padding:16,width:800,margin:\"auto\",marginTop:64},children:/*#__PURE__*/_jsxs(Title,{level:4,children:[\"Distribution \",currentDistribution.id,\" in progress\"]})});}return/*#__PURE__*/_jsxs(\"div\",{style:{border:\"1px solid\",padding:\"40px\",width:\"800px\",margin:\"64px auto 0px auto\",textAlign:\"left\"},children:[/*#__PURE__*/_jsx(Title,{level:3,style:{fontFamily:\"Space Mono\"},children:\"Add members\"}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(Form,{form:form,name:\"basic\",onFinish:handleSubmit,labelCol:{span:8},wrapperCol:{span:16},layout:\"horizontal\",children:[/*#__PURE__*/_jsx(Form.Item,{label:\"Vote Allocation\",name:\"voteCredit\",style:{textAlign:\"left\"},tooltip:\"Number of votes each voter will have\",children:/*#__PURE__*/_jsx(Input,{type:\"number\",placeholder:\"100\",style:{width:\"30%\"},onChange:function onChange(event){return setVoteAllocation(event.target.value);}})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Button,{type:\"primary\",block:true,onClick:function onClick(){return handleAddVoters();},children:\"Add Voters from Clipboard\"}),/*#__PURE__*/_jsx(Divider,{}),voters.map(function(_,index){return/*#__PURE__*/_jsx(VoterInput,{index:index,setVoters:setVoters,voters:voters,mainnetProvider:mainnetProvider},index);}),/*#__PURE__*/_jsx(Form.Item,{style:{justifyContent:\"center\",marginTop:24},children:/*#__PURE__*/_jsx(Button,{type:\"dashed\",block:true,icon:/*#__PURE__*/_jsx(PlusOutlined,{}),onClick:function onClick(){return setVoters(function(prevVoters){return[].concat(_toConsumableArray(prevVoters),[\"\"]);});},children:\"Add Voter\"})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Button,{type:\"primary\",block:true,onClick:function onClick(){return handleAddCandidates();},children:\"Add Candidates from Clipboard\"}),/*#__PURE__*/_jsx(Divider,{}),candidates.map(function(_,index){return/*#__PURE__*/_jsx(VoterInput,{index:index,setVoters:setCandidates,voters:candidates,mainnetProvider:mainnetProvider},index);}),/*#__PURE__*/_jsx(Form.Item,{style:{justifyContent:\"center\",marginTop:24},children:/*#__PURE__*/_jsx(Button,{type:\"dashed\",block:true,icon:/*#__PURE__*/_jsx(PlusOutlined,{}),onClick:function onClick(){return setCandidates(function(prevCandidates){return[].concat(_toConsumableArray(prevCandidates),[\"\"]);});},children:\"Add Candidate\"})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Form.Item,{wrapperCol:{offset:16,span:8},children:!isSendingTx?/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",block:true,disabled:!voteAllocation,children:\"Submit\"}):/*#__PURE__*/_jsx(Spin,{size:\"small\"})})]})]});}var VoterInput=function VoterInput(_ref5){var index=_ref5.index,voters=_ref5.voters,setVoters=_ref5.setVoters,mainnetProvider=_ref5.mainnetProvider;return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Form.Item,{label:\"Voter \".concat(index+1),name:\"address[\".concat(index,\"]\"),style:{marginBottom:\"16px\"},children:/*#__PURE__*/_jsxs(Row,{gutter:8,align:\"middle\",children:[/*#__PURE__*/_jsx(Col,{span:16,children:/*#__PURE__*/_jsx(AddressInput,{autoFocus:true,ensProvider:mainnetProvider,placeholder:\"Enter address\",value:voters[index],onChange:function onChange(address){setVoters(function(prevVoters){var nextVoters=_toConsumableArray(prevVoters);nextVoters[index]=address;return nextVoters;});}})}),/*#__PURE__*/_jsx(Col,{span:8,children:/*#__PURE__*/_jsx(DeleteOutlined,{style:{cursor:\"pointer\",color:\"#ff6666\"},onClick:function onClick(event){setVoters(function(prevVoters){var nextVoters=_toConsumableArray(prevVoters);return nextVoters.filter(function(_,i){return i!==index;});});}})})]})})});};","map":{"version":3,"sources":["C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/packages/react-app/src/views/QuadraticDiplomacyCreate.jsx"],"names":["React","useState","Form","Input","Divider","Button","Typography","Row","Col","Spin","PlusOutlined","DeleteOutlined","AddressInput","Title","axios","require","ethers","QuadraticDiplomacyCreate","mainnetProvider","serverUrl","address","userSigner","currentDistribution","setCurrentDistribution","isAdmin","voters","setVoters","candidates","setCandidates","voteAllocation","setVoteAllocation","isSendingTx","setIsSendingTx","useForm","form","handleAddVoters","navigator","clipboard","readText","text","addresses","split","length","forEach","voteAddress","voteAddressWithChecksum","utils","getAddress","includes","prevVoters","error","console","log","handleAddCandidates","candidateAddress","candidateAddressWithChecksum","prevCandidates","handleSubmit","filteredVoters","filter","voter","filteredCandidates","message","signMessage","signature","post","members","then","response","resetFields","catch","e","border","padding","width","margin","marginTop","id","textAlign","fontFamily","span","event","target","value","map","_","index","justifyContent","offset","VoterInput","marginBottom","nextVoters","cursor","color","i"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\r\nimport { Form, Input, Divider, Button, Typography, Row, Col, Spin } from \"antd\";\r\nimport { PlusOutlined } from \"@ant-design/icons\";\r\nimport { DeleteOutlined } from \"@ant-design/icons\";\r\nimport { AddressInput } from \"../components\";\r\nconst { Title } = Typography;\r\nconst axios = require(\"axios\");\r\nconst { ethers } = require(\"ethers\");\r\n\r\nexport default function QuadraticDiplomacyCreate({\r\n  mainnetProvider,\r\n  serverUrl,\r\n  address,\r\n  userSigner,\r\n  currentDistribution,\r\n  setCurrentDistribution,\r\n  isAdmin,\r\n}) {\r\n  const [voters, setVoters] = useState([\"\"]);\r\n  const [candidates, setCandidates] = useState([\"\"]);\r\n  const [voteAllocation, setVoteAllocation] = useState(0);\r\n  const [isSendingTx, setIsSendingTx] = useState(false);\r\n  const [form] = Form.useForm();\r\n\r\n  const handleAddVoters = async () => {\r\n    const text = await navigator.clipboard.readText();\r\n    const addresses = text.split(\",\");\r\n    if (voters.length === 1 && voters[0] === \"\") {\r\n      setVoters([]);\r\n    }\r\n    addresses.forEach(voteAddress => {\r\n      try {\r\n        const voteAddressWithChecksum = ethers.utils.getAddress(voteAddress);\r\n        if (!voters.includes(voteAddressWithChecksum)) {\r\n          setVoters(prevVoters => [...prevVoters, voteAddressWithChecksum]);\r\n        }\r\n      } catch (error) {\r\n        console.log(\"Error parsing address \", voteAddress);\r\n        console.log(error);\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleAddCandidates = async () => {\r\n    const text = await navigator.clipboard.readText();\r\n    const addresses = text.split(\",\");\r\n    if (voters.length === 1 && voters[0] === \"\") {\r\n      setVoters([]);\r\n    }\r\n    addresses.forEach(candidateAddress => {\r\n      try {\r\n        const candidateAddressWithChecksum = ethers.utils.getAddress(candidateAddress);\r\n        if (!candidates.includes(candidateAddressWithChecksum)) {\r\n          setCandidates(prevCandidates => [...prevCandidates, candidateAddressWithChecksum]);\r\n        }\r\n      } catch (error) {\r\n        console.log(\"Error parsing address \", candidateAddress);\r\n        console.log(error);\r\n      }\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    // ToDo. Check if addresses are valid.\r\n    setIsSendingTx(true);\r\n    const filteredVoters = voters.filter(voter => voter);\r\n    const filteredCandidates = candidates.filter(voter => voter);\r\n\r\n    let message = \"qdip-creation-\" + address;\r\n    console.log(\"Message:\" + message);\r\n\r\n    const signature = await userSigner.signMessage(message);\r\n\r\n    axios\r\n      .post(serverUrl + \"distributions\", {\r\n        address: address,\r\n        voteAllocation: voteAllocation,\r\n        members: filteredVoters,\r\n        candidates: filteredCandidates,\r\n        signature: signature,\r\n      })\r\n      .then(response => {\r\n        console.log(response);\r\n        setCurrentDistribution(response);\r\n        setVoters([\"\"]);\r\n        setVoteAllocation(0);\r\n        form.resetFields();\r\n        setIsSendingTx(false);\r\n      })\r\n      .catch(e => {\r\n        console.log(\"Error on distributions post\");\r\n      });\r\n  };\r\n\r\n  if (!isAdmin) {\r\n    return (\r\n      <div style={{ border: \"1px solid #cccccc\", padding: 16, width: 800, margin: \"auto\", marginTop: 64 }}>\r\n        <Title level={4}>Access denied</Title>\r\n        <p>Only admins can create distributions.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (currentDistribution.id) {\r\n    return (\r\n      <div style={{ border: \"1px solid #cccccc\", padding: 16, width: 800, margin: \"auto\", marginTop: 64 }}>\r\n        <Title level={4}>Distribution {currentDistribution.id} in progress</Title>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ border: \"1px solid\", padding: \"40px\", width: \"800px\", margin: \"64px auto 0px auto\", textAlign: \"left\" }}>\r\n      <Title level={3} style={{ fontFamily: \"Space Mono\" }}>Add members</Title>\r\n      <Divider />\r\n      <Form form={form} name=\"basic\" onFinish={handleSubmit} labelCol={{ span: 8 }} wrapperCol={{ span: 16 }} layout=\"horizontal\">\r\n        <Form.Item label=\"Vote Allocation\" name=\"voteCredit\" style={{ textAlign: \"left\" }} tooltip=\"Number of votes each voter will have\">\r\n          <Input\r\n            type=\"number\"\r\n            placeholder=\"100\"\r\n            style={{ width: \"30%\" }}\r\n            onChange={event => setVoteAllocation(event.target.value)}\r\n          />\r\n        </Form.Item>\r\n        <Divider />\r\n        <Button type=\"primary\" block onClick={() => handleAddVoters()}>\r\n          Add Voters from Clipboard\r\n        </Button>\r\n        <Divider />\r\n        {voters.map((_, index) => (\r\n          <VoterInput\r\n            key={index}\r\n            index={index}\r\n            setVoters={setVoters}\r\n            voters={voters}\r\n            mainnetProvider={mainnetProvider}\r\n          />\r\n        ))}\r\n        <Form.Item style={{ justifyContent: \"center\", marginTop: 24 }}>\r\n          {/*ToDo. Restart ant form state (the browser is keeping filled-removed elements)*/}\r\n          <Button\r\n            type=\"dashed\"\r\n            block\r\n            icon={<PlusOutlined />}\r\n            onClick={() => setVoters(prevVoters => [...prevVoters, \"\"])}\r\n          >\r\n            Add Voter\r\n          </Button>\r\n        </Form.Item>\r\n        <Divider />\r\n        <Button type=\"primary\" block onClick={() => handleAddCandidates()}>\r\n          Add Candidates from Clipboard\r\n        </Button>\r\n        <Divider />\r\n        {candidates.map((_, index) => (\r\n          <VoterInput\r\n            key={index}\r\n            index={index}\r\n            setVoters={setCandidates}\r\n            voters={candidates}\r\n            mainnetProvider={mainnetProvider}\r\n          />\r\n        ))}\r\n        <Form.Item style={{ justifyContent: \"center\", marginTop: 24 }}>\r\n          {/*ToDo. Restart ant form state (the browser is keeping filled-removed elements)*/}\r\n          <Button\r\n            type=\"dashed\"\r\n            block\r\n            icon={<PlusOutlined />}\r\n            onClick={() => setCandidates(prevCandidates => [...prevCandidates, \"\"])}\r\n          >\r\n            Add Candidate\r\n          </Button>\r\n        </Form.Item>\r\n        <Divider />\r\n        <Form.Item wrapperCol={{ offset: 16, span: 8 }}>\r\n          {!isSendingTx ? (\r\n            <Button type=\"primary\" htmlType=\"submit\" block disabled={!voteAllocation}>\r\n              Submit\r\n            </Button>\r\n          ) : (\r\n            <Spin size=\"small\" />\r\n          )}\r\n        </Form.Item>\r\n      </Form>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst VoterInput = ({ index, voters, setVoters, mainnetProvider }) => {\r\n  return (\r\n    <>\r\n      <Form.Item label={`Voter ${index + 1}`} name={`address[${index}]`} style={{ marginBottom: \"16px\" }}>\r\n        <Row gutter={8} align=\"middle\">\r\n          <Col span={16}>\r\n            <AddressInput\r\n              autoFocus\r\n              ensProvider={mainnetProvider}\r\n              placeholder=\"Enter address\"\r\n              value={voters[index]}\r\n              onChange={address => {\r\n                setVoters(prevVoters => {\r\n                  const nextVoters = [...prevVoters];\r\n                  nextVoters[index] = address;\r\n                  return nextVoters;\r\n                });\r\n              }}\r\n            />\r\n          </Col>\r\n          <Col span={8}>\r\n            <DeleteOutlined\r\n              style={{ cursor: \"pointer\", color: \"#ff6666\" }}\r\n              onClick={event => {\r\n                setVoters(prevVoters => {\r\n                  const nextVoters = [...prevVoters];\r\n                  return nextVoters.filter((_, i) => i !== index);\r\n                });\r\n              }}\r\n            />\r\n          </Col>\r\n        </Row>\r\n      </Form.Item>\r\n    </>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}