{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _defineProperty from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useMemo}from\"react\";import{Button,Checkbox,Divider,Space,List,Steps,Typography,Badge,Spin,Row,Col}from\"antd\";import{SmileTwoTone,LikeTwoTone,CheckCircleTwoTone,MinusOutlined,PlusOutlined}from\"@ant-design/icons\";import{Address}from\"../components\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Title=Typography.Title,Text=Typography.Text;var axios=require(\"axios\");export default function QuadraticDiplomacyVote(_ref){var contributorEntries=_ref.contributorEntries,isVoter=_ref.isVoter,mainnetProvider=_ref.mainnetProvider,currentDistribution=_ref.currentDistribution,address=_ref.address,userSigner=_ref.userSigner,serverUrl=_ref.serverUrl;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),selectedContributors=_useState2[0],setSelectedContributors=_useState2[1];var _useState3=useState(1),_useState4=_slicedToArray(_useState3,2),currentStep=_useState4[0],setCurrentStep=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),spentVoteTokens=_useState6[0],setSpentVoteTokens=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isSendingTx=_useState8[0],setIsSendingTx=_useState8[1];if(Object.keys(selectedContributors).length===0&&currentDistribution.id){setSelectedContributors(currentDistribution.candidates.reduce(function(entries,current){entries[current]=0;return entries;},{}));}var contributors=useMemo(function(){return currentDistribution.id&&currentDistribution.candidates.reduce(function(entries,current){entries[current]=0;return entries;},{});},[currentDistribution.id]);var remainingVoteTokens=useMemo(function(){return currentDistribution.id&&currentDistribution.voteAllocation-spentVoteTokens;},[currentDistribution.id,spentVoteTokens]);if(!isVoter){return/*#__PURE__*/_jsxs(\"div\",{style:{border:\"1px solid\",padding:\"40px\",width:800,margin:\"auto\",marginTop:64,textAlign:\"left\"},children:[/*#__PURE__*/_jsx(Title,{level:4,style:{fontFamily:\"Space Mono\"},children:\"Access denied\"}),/*#__PURE__*/_jsx(\"p\",{children:\"You are not part of the voters of this election.\"})]});}var handleContributorVote=function handleContributorVote(e,op,clickedContributorAddress){// adjust available vote tokens\nsetSpentVoteTokens(function(prevSpentVoteTokens){return op===\"add\"?prevSpentVoteTokens+1:prevSpentVoteTokens-1;});// update contributor vote tokens\nsetSelectedContributors(function(prevSelectedContributors){return _objectSpread(_objectSpread({},prevSelectedContributors),{},_defineProperty({},clickedContributorAddress,op===\"add\"?Math.min(prevSelectedContributors[clickedContributorAddress]+1,currentDistribution.voteAllocation):Math.max(prevSelectedContributors[clickedContributorAddress]-1,0)));});};var handleSubmitVotes=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var wallets,amounts,sortedVotes,message,signature;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:wallets=[];amounts=[];sortedVotes=Object.keys(selectedContributors).sort();message=\"qdip-vote-\"+currentDistribution.id+address+sortedVotes.join()+sortedVotes.map(function(voter){return selectedContributors[voter];}).join();_context.next=6;return userSigner.signMessage(message);case 6:signature=_context.sent;setIsSendingTx(true);axios.post(serverUrl+\"distributions/\"+currentDistribution.id+\"/vote\",{address:address,votes:selectedContributors,signature:signature}).then(function(response){console.log(response);setIsSendingTx(false);setSpentVoteTokens(0);setCurrentStep(2);}).catch(function(e){console.log(\"Error on vote\");setIsSendingTx(false);});case 9:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmitVotes(){return _ref2.apply(this,arguments);};}();if(!currentDistribution.id){return/*#__PURE__*/_jsx(\"div\",{style:{border:\"1px solid #cccccc\",padding:16,width:800,margin:\"auto\",marginTop:64},children:/*#__PURE__*/_jsx(Title,{level:4,children:\"No Current Distribution\"})});}if(currentDistribution.id&&currentStep!=2&&currentDistribution.votes&&currentDistribution.votes[address]){setSelectedContributors(currentDistribution.votes[address]);setCurrentStep(2);}return/*#__PURE__*/_jsxs(\"div\",{style:{border:\"1px solid\",padding:\"40px\",width:800,margin:\"auto\",marginTop:64,textAlign:\"left\"},children:[/*#__PURE__*/_jsxs(Title,{level:3,children:[\"Distribution \",currentDistribution.id]}),/*#__PURE__*/_jsx(Divider,{}),currentStep===1?/*#__PURE__*/_jsx(List,{size:\"large\",itemLayout:\"horizontal\",style:{width:\"600px\",margin:\"0 auto\"},header:/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",children:[/*#__PURE__*/_jsx(Title,{level:4,style:{fontFamily:\"Space Mono\"},children:\"Allocate votes\"}),/*#__PURE__*/_jsxs(Title,{level:5,children:[\"Remaining vote tokens:\\xA0\\xA0\",/*#__PURE__*/_jsx(Badge,{showZero:true,overflowCount:1000,count:remainingVoteTokens,style:{backgroundColor:\"#52c41a\"}})]})]}),footer:/*#__PURE__*/_jsx(Row,{justify:\"end\",children:!isSendingTx?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:handleSubmitVotes,children:\"Commit votes\"})}):/*#__PURE__*/_jsx(Spin,{size:\"small\"})}),dataSource:Object.entries(selectedContributors),renderItem:function renderItem(_ref3){var _ref4=_slicedToArray(_ref3,2),contributorAddress=_ref4[0],contributor=_ref4[1];return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Badge.Ribbon,{showZero:true,overflowCount:1000,text:/*#__PURE__*/_jsxs(Title,{level:5,children:[contributor,\" \"]}),style:{backgroundColor:contributor?\"#eb2f96\":\"grey\",height:24,width:30,marginRight:-5}}),/*#__PURE__*/_jsx(List.Item,{extra:/*#__PURE__*/_jsxs(Button.Group,{children:[/*#__PURE__*/_jsx(Button,{danger:true,ghost:true,onClick:function onClick(e){return handleContributorVote(e,\"remove\",contributorAddress);},disabled:!contributor,children:/*#__PURE__*/_jsx(MinusOutlined,{})}),/*#__PURE__*/_jsx(Button,{type:\"primary\",ghost:true,onClick:function onClick(e){return handleContributorVote(e,\"add\",contributorAddress);},disabled:!remainingVoteTokens,children:/*#__PURE__*/_jsx(PlusOutlined,{})})]}),children:/*#__PURE__*/_jsx(List.Item.Meta,{avatar:/*#__PURE__*/_jsx(Address,{address:contributorAddress,fontSize:16,size:\"short\",ensProvider:mainnetProvider})})},contributorAddress)]});}}):currentStep===2&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Title,{level:3,style:{fontFamily:\"Space Mono\"},children:\"Thank you for voting.\"}),/*#__PURE__*/_jsx(\"p\",{children:\"The allocation to this workstream will be informed by your votes.\"}),/*#__PURE__*/_jsx(Title,{level:5,style:{marginTop:\"24px\"},children:\"Your votes:\"}),Object.entries(selectedContributors).map(function(_ref5){var _ref6=_slicedToArray(_ref5,2),contributorAddress=_ref6[0],voteTokens=_ref6[1];return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Address,{address:contributorAddress,fontSize:16,size:\"short\",ensProvider:mainnetProvider}),\" (\",/*#__PURE__*/_jsx(Text,{children:voteTokens}),\")\"]},contributorAddress);})]})]});}","map":{"version":3,"sources":["C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/packages/react-app/src/views/QuadraticDiplomacyVote.jsx"],"names":["React","useEffect","useState","useMemo","Button","Checkbox","Divider","Space","List","Steps","Typography","Badge","Spin","Row","Col","SmileTwoTone","LikeTwoTone","CheckCircleTwoTone","MinusOutlined","PlusOutlined","Address","Title","Text","axios","require","QuadraticDiplomacyVote","contributorEntries","isVoter","mainnetProvider","currentDistribution","address","userSigner","serverUrl","selectedContributors","setSelectedContributors","currentStep","setCurrentStep","spentVoteTokens","setSpentVoteTokens","isSendingTx","setIsSendingTx","Object","keys","length","id","candidates","reduce","entries","current","contributors","remainingVoteTokens","voteAllocation","border","padding","width","margin","marginTop","textAlign","fontFamily","handleContributorVote","e","op","clickedContributorAddress","prevSpentVoteTokens","prevSelectedContributors","Math","min","max","handleSubmitVotes","wallets","amounts","sortedVotes","sort","message","join","map","voter","signMessage","signature","post","votes","then","response","console","log","catch","backgroundColor","contributorAddress","contributor","height","marginRight","voteTokens"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useMemo } from \"react\";\r\nimport { Button, Checkbox, Divider, Space, List, Steps, Typography, Badge, Spin, Row, Col } from \"antd\";\r\nimport { SmileTwoTone, LikeTwoTone, CheckCircleTwoTone, MinusOutlined, PlusOutlined } from \"@ant-design/icons\";\r\nimport { Address } from \"../components\";\r\nconst { Title, Text } = Typography;\r\nconst axios = require(\"axios\");\r\n\r\nexport default function QuadraticDiplomacyVote({\r\n  contributorEntries,\r\n  isVoter,\r\n  mainnetProvider,\r\n  currentDistribution,\r\n  address,\r\n  userSigner,\r\n  serverUrl,\r\n}) {\r\n  const [selectedContributors, setSelectedContributors] = useState({});\r\n  const [currentStep, setCurrentStep] = useState(1);\r\n  const [spentVoteTokens, setSpentVoteTokens] = useState(0);\r\n  const [isSendingTx, setIsSendingTx] = useState(false);\r\n\r\n  if (Object.keys(selectedContributors).length === 0 && currentDistribution.id) {\r\n    setSelectedContributors(\r\n      currentDistribution.candidates.reduce((entries, current) => {\r\n        entries[current] = 0;\r\n        return entries;\r\n      }, {}),\r\n    );\r\n  }\r\n\r\n  const contributors = useMemo(\r\n    () =>\r\n      currentDistribution.id &&\r\n      currentDistribution.candidates.reduce((entries, current) => {\r\n        entries[current] = 0;\r\n        return entries;\r\n      }, {}),\r\n    [currentDistribution.id],\r\n  );\r\n\r\n  const remainingVoteTokens = useMemo(\r\n    () => currentDistribution.id && currentDistribution.voteAllocation - spentVoteTokens,\r\n    [currentDistribution.id, spentVoteTokens],\r\n  );\r\n\r\n  if (!isVoter) {\r\n    return (\r\n      <div style={{ border: \"1px solid\", padding: \"40px\", width: 800, margin: \"auto\", marginTop: 64, textAlign: \"left\" }}>\r\n        <Title level={4} style={{ fontFamily: \"Space Mono\" }}>Access denied</Title>\r\n        <p>You are not part of the voters of this election.</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handleContributorVote = (e, op, clickedContributorAddress) => {\r\n    // adjust available vote tokens\r\n    setSpentVoteTokens(prevSpentVoteTokens => (op === \"add\" ? prevSpentVoteTokens + 1 : prevSpentVoteTokens - 1));\r\n\r\n    // update contributor vote tokens\r\n    setSelectedContributors(prevSelectedContributors => ({\r\n      ...prevSelectedContributors,\r\n      [clickedContributorAddress]:\r\n        op === \"add\"\r\n          ? Math.min(prevSelectedContributors[clickedContributorAddress] + 1, currentDistribution.voteAllocation)\r\n          : Math.max(prevSelectedContributors[clickedContributorAddress] - 1, 0),\r\n    }));\r\n  };\r\n\r\n  const handleSubmitVotes = async () => {\r\n    const wallets = [];\r\n    const amounts = [];\r\n\r\n    const sortedVotes = Object.keys(selectedContributors).sort();\r\n\r\n    const message =\r\n      \"qdip-vote-\" +\r\n      currentDistribution.id +\r\n      address +\r\n      sortedVotes.join() +\r\n      sortedVotes.map(voter => selectedContributors[voter]).join();\r\n\r\n    const signature = await userSigner.signMessage(message);\r\n\r\n    setIsSendingTx(true);\r\n\r\n    axios\r\n      .post(serverUrl + \"distributions/\" + currentDistribution.id + \"/vote\", {\r\n        address: address,\r\n        votes: selectedContributors,\r\n        signature: signature,\r\n      })\r\n      .then(response => {\r\n        console.log(response);\r\n        setIsSendingTx(false);\r\n        setSpentVoteTokens(0);\r\n        setCurrentStep(2);\r\n      })\r\n      .catch(e => {\r\n        console.log(\"Error on vote\");\r\n        setIsSendingTx(false);\r\n      });\r\n  };\r\n\r\n  if (!currentDistribution.id) {\r\n    return (\r\n      <div style={{ border: \"1px solid #cccccc\", padding: 16, width: 800, margin: \"auto\", marginTop: 64 }}>\r\n        <Title level={4}>No Current Distribution</Title>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (\r\n    currentDistribution.id &&\r\n    currentStep != 2 &&\r\n    currentDistribution.votes &&\r\n    currentDistribution.votes[address]\r\n  ) {\r\n    setSelectedContributors(currentDistribution.votes[address]);\r\n    setCurrentStep(2);\r\n  }\r\n\r\n  return (\r\n    <div style={{ border: \"1px solid\", padding: \"40px\", width: 800, margin: \"auto\", marginTop: 64, textAlign: \"left\" }}>\r\n      <Title level={3}>Distribution {currentDistribution.id}</Title>\r\n      <Divider />\r\n      {currentStep === 1 ? (\r\n        <List\r\n          size=\"large\"\r\n          itemLayout=\"horizontal\"\r\n          style={{ width: \"600px\", margin: \"0 auto\" }}\r\n          header={\r\n            <Space direction=\"vertical\">\r\n              <Title level={4} style={{ fontFamily: \"Space Mono\" }}>Allocate votes</Title>\r\n              <Title level={5}>\r\n                Remaining vote tokens:&nbsp;&nbsp;\r\n                <Badge\r\n                  showZero\r\n                  overflowCount={1000}\r\n                  count={remainingVoteTokens}\r\n                  style={{ backgroundColor: \"#52c41a\" }}\r\n                />\r\n              </Title>\r\n            </Space>\r\n          }\r\n          footer={\r\n            <Row justify=\"end\">\r\n              {!isSendingTx ? (\r\n                <>\r\n                  <Button type=\"primary\" onClick={handleSubmitVotes}>\r\n                    Commit votes\r\n                  </Button>\r\n                </>\r\n              ) : (\r\n                <Spin size=\"small\" />\r\n              )}\r\n            </Row>\r\n          }\r\n          dataSource={Object.entries(selectedContributors)}\r\n          renderItem={([contributorAddress, contributor]) => (\r\n            <>\r\n              <Badge.Ribbon\r\n                showZero\r\n                overflowCount={1000}\r\n                text={<Title level={5}>{contributor} </Title>}\r\n                style={{\r\n                  backgroundColor: contributor ? \"#eb2f96\" : \"grey\",\r\n                  height: 24,\r\n                  width: 30,\r\n                  marginRight: -5,\r\n                }}\r\n              />\r\n              <List.Item\r\n                key={contributorAddress}\r\n                extra={\r\n                  <Button.Group>\r\n                    <Button\r\n                      danger\r\n                      ghost\r\n                      onClick={e => handleContributorVote(e, \"remove\", contributorAddress)}\r\n                      disabled={!contributor}\r\n                    >\r\n                      <MinusOutlined />\r\n                    </Button>\r\n                    <Button\r\n                      type=\"primary\"\r\n                      ghost\r\n                      onClick={e => handleContributorVote(e, \"add\", contributorAddress)}\r\n                      disabled={!remainingVoteTokens}\r\n                    >\r\n                      <PlusOutlined />\r\n                    </Button>\r\n                  </Button.Group>\r\n                }\r\n              >\r\n                <List.Item.Meta\r\n                  avatar={\r\n                    <Address address={contributorAddress} fontSize={16} size=\"short\" ensProvider={mainnetProvider} />\r\n                  }\r\n                />\r\n              </List.Item>\r\n            </>\r\n          )}\r\n        />\r\n      ) : (\r\n        currentStep === 2 && (\r\n          <>\r\n            <Title level={3} style={{ fontFamily: \"Space Mono\" }}>Thank you for voting.</Title>\r\n            <p>The allocation to this workstream will be informed by your votes.</p>\r\n            <Title level={5} style={{ marginTop: \"24px\" }}>Your votes:</Title>\r\n            {Object.entries(selectedContributors).map(([contributorAddress, voteTokens]) => (\r\n              <div key={contributorAddress}>\r\n                <Address address={contributorAddress} fontSize={16} size=\"short\" ensProvider={mainnetProvider} /> (\r\n                <Text>{voteTokens}</Text>)\r\n              </div>\r\n            ))}\r\n          </>\r\n        )\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"]},"metadata":{},"sourceType":"module"}