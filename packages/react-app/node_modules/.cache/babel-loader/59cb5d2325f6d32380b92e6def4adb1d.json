{"ast":null,"code":"import _slicedToArray from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{RetweetOutlined,SettingOutlined}from\"@ant-design/icons\";import{ChainId,Fetcher,Percent,Token,TokenAmount,Trade,WETH}from\"@uniswap/sdk\";import{abi as IUniswapV2Router02ABI}from\"@uniswap/v2-periphery/build/IUniswapV2Router02.json\";import{Button,Card,Descriptions,Divider,Drawer,InputNumber,Modal,notification,Row,Select,Space,Tooltip,Typography}from\"antd\";import{useBlockNumber,usePoller}from\"eth-hooks\";import{ethers}from\"ethers\";import React,{useEffect,useState}from\"react\";import{useDebounce}from\"../hooks\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Option=Select.Option;var Text=Typography.Text;export var ROUTER_ADDRESS=\"0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D\";export var ZERO_ADDRESS=\"0x0000000000000000000000000000000000000000\";var erc20Abi=[\"function balanceOf(address owner) view returns (uint256)\",\"function approve(address _spender, uint256 _value) public returns (bool success)\",\"function allowance(address _owner, address _spender) public view returns (uint256 remaining)\"];var makeCall=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(callName,contract,args){var metadata,result,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:metadata=_args.length>3&&_args[3]!==undefined?_args[3]:{};if(!contract[callName]){_context.next=12;break;}if(!args){_context.next=8;break;}_context.next=5;return contract[callName].apply(contract,_toConsumableArray(args).concat([metadata]));case 5:result=_context.sent;_context.next=11;break;case 8:_context.next=10;return contract[callName]();case 10:result=_context.sent;case 11:return _context.abrupt(\"return\",result);case 12:console.log(\"no call of that name!\");case 13:case\"end\":return _context.stop();}}},_callee);}));return function makeCall(_x,_x2,_x3){return _ref.apply(this,arguments);};}();var defaultToken=\"ETH\";var defaultTokenOut=\"DAI\";var defaultSlippage=\"0.5\";var defaultTimeLimit=60*10;var tokenListToObject=function tokenListToObject(array){return array.reduce(function(obj,item){obj[item.symbol]=new Token(item.chainId,item.address,item.decimals,item.symbol,item.name);return obj;},{});};function Swap(_ref2){var selectedProvider=_ref2.selectedProvider,tokenListURI=_ref2.tokenListURI;var _useState=useState(defaultToken),_useState2=_slicedToArray(_useState,2),tokenIn=_useState2[0],setTokenIn=_useState2[1];var _useState3=useState(defaultTokenOut),_useState4=_slicedToArray(_useState3,2),tokenOut=_useState4[0],setTokenOut=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),exact=_useState6[0],setExact=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),amountIn=_useState8[0],setAmountIn=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),amountInMax=_useState10[0],setAmountInMax=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),amountOut=_useState12[0],setAmountOut=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),amountOutMin=_useState14[0],setAmountOutMin=_useState14[1];var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),trades=_useState16[0],setTrades=_useState16[1];var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),routerAllowance=_useState18[0],setRouterAllowance=_useState18[1];var _useState19=useState(),_useState20=_slicedToArray(_useState19,2),balanceIn=_useState20[0],setBalanceIn=_useState20[1];var _useState21=useState(),_useState22=_slicedToArray(_useState21,2),balanceOut=_useState22[0],setBalanceOut=_useState22[1];var _useState23=useState(new Percent(Math.round(defaultSlippage*100).toString(),\"10000\")),_useState24=_slicedToArray(_useState23,2),slippageTolerance=_useState24[0],setSlippageTolerance=_useState24[1];var _useState25=useState(defaultTimeLimit),_useState26=_slicedToArray(_useState25,2),timeLimit=_useState26[0],setTimeLimit=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),swapping=_useState28[0],setSwapping=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),approving=_useState30[0],setApproving=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),settingsVisible=_useState32[0],setSettingsVisible=_useState32[1];var _useState33=useState(false),_useState34=_slicedToArray(_useState33,2),swapModalVisible=_useState34[0],setSwapModalVisible=_useState34[1];var _useState35=useState([]),_useState36=_slicedToArray(_useState35,2),tokenList=_useState36[0],setTokenList=_useState36[1];var _useState37=useState(),_useState38=_slicedToArray(_useState37,2),tokens=_useState38[0],setTokens=_useState38[1];var _useState39=useState(false),_useState40=_slicedToArray(_useState39,2),invertPrice=_useState40[0],setInvertPrice=_useState40[1];var blockNumber=useBlockNumber(selectedProvider,3000);var signer=selectedProvider.getSigner();var routerContract=new ethers.Contract(ROUTER_ADDRESS,IUniswapV2Router02ABI,signer);var _tokenListUri=tokenListURI||\"https://gateway.ipfs.io/ipns/tokens.uniswap.org\";var debouncedAmountIn=useDebounce(amountIn,500);var debouncedAmountOut=useDebounce(amountOut,500);var activeChainId=process.env.REACT_APP_NETWORK===\"kovan\"?ChainId.KOVAN:ChainId.MAINNET;useEffect(function(){var getTokenList=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _tokenList2,tokenListJson,filteredTokens,ethToken,_tokenList,_tokens;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(_tokenListUri);_context2.prev=1;_context2.next=4;return fetch(_tokenListUri);case 4:_tokenList2=_context2.sent;_context2.next=7;return _tokenList2.json();case 7:tokenListJson=_context2.sent;filteredTokens=tokenListJson.tokens.filter(function(t){return t.chainId===activeChainId;});ethToken=WETH[activeChainId];ethToken.name=\"Ethereum\";ethToken.symbol=\"ETH\";ethToken.logoURI=\"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png\";_tokenList=[ethToken].concat(_toConsumableArray(filteredTokens));setTokenList(_tokenList);_tokens=tokenListToObject(_tokenList);setTokens(_tokens);_context2.next=22;break;case 19:_context2.prev=19;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);case 22:case\"end\":return _context2.stop();}}},_callee2,null,[[1,19]]);}));return function getTokenList(){return _ref3.apply(this,arguments);};}();getTokenList();},[tokenListURI]);var getTrades=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var pairs,baseTokens,listOfPairwiseTokens,getPairs,listOfPairs,bestTrade;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!(tokenIn&&tokenOut&&(amountIn||amountOut))){_context4.next=11;break;}pairs=function pairs(arr){return arr.map(function(v,i){return arr.slice(i+1).map(function(w){return[v,w];});}).flat();};baseTokens=tokenList.filter(function(t){return[\"DAI\",\"USDC\",\"USDT\",\"COMP\",\"ETH\",\"MKR\",\"LINK\",tokenIn,tokenOut].includes(t.symbol);}).map(function(el){return new Token(el.chainId,el.address,el.decimals,el.symbol,el.name);});listOfPairwiseTokens=pairs(baseTokens);getPairs=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(list){var listOfPromises;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:listOfPromises=list.map(function(item){return Fetcher.fetchPairData(item[0],item[1],selectedProvider);});return _context3.abrupt(\"return\",Promise.all(listOfPromises.map(function(p){return p.catch(function(){return undefined;});})));case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function getPairs(_x4){return _ref5.apply(this,arguments);};}();_context4.next=7;return getPairs(listOfPairwiseTokens);case 7:listOfPairs=_context4.sent;if(exact===\"in\"){setAmountInMax();bestTrade=Trade.bestTradeExactIn(listOfPairs.filter(function(item){return item;}),new TokenAmount(tokens[tokenIn],ethers.utils.parseUnits(amountIn.toString(),tokens[tokenIn].decimals)),tokens[tokenOut],{maxNumResults:3,maxHops:1});if(bestTrade[0]){setAmountOut(bestTrade[0].outputAmount.toSignificant(6));}else{setAmountOut();}}else if(exact===\"out\"){setAmountOutMin();bestTrade=Trade.bestTradeExactOut(listOfPairs.filter(function(item){return item;}),tokens[tokenIn],new TokenAmount(tokens[tokenOut],ethers.utils.parseUnits(amountOut.toString(),tokens[tokenOut].decimals)),{maxNumResults:3,maxHops:1});if(bestTrade[0]){setAmountIn(bestTrade[0].inputAmount.toSignificant(6));}else{setAmountIn();}}setTrades(bestTrade);console.log(bestTrade);case 11:case\"end\":return _context4.stop();}}},_callee4);}));return function getTrades(){return _ref4.apply(this,arguments);};}();useEffect(function(){getTrades();},[tokenIn,tokenOut,debouncedAmountIn,debouncedAmountOut,slippageTolerance,selectedProvider]);useEffect(function(){if(trades&&trades[0]){if(exact===\"in\"){setAmountOutMin(trades[0].minimumAmountOut(slippageTolerance));}else if(exact===\"out\"){setAmountInMax(trades[0].maximumAmountIn(slippageTolerance));}}},[slippageTolerance,amountIn,amountOut,trades]);var getBalance=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_token,_account,_contract){var newBalance;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(_token===\"ETH\")){_context5.next=6;break;}_context5.next=3;return selectedProvider.getBalance(_account);case 3:newBalance=_context5.sent;_context5.next=9;break;case 6:_context5.next=8;return makeCall(\"balanceOf\",_contract,[_account]);case 8:newBalance=_context5.sent;case 9:return _context5.abrupt(\"return\",newBalance);case 10:case\"end\":return _context5.stop();}}},_callee5);}));return function getBalance(_x5,_x6,_x7){return _ref6.apply(this,arguments);};}();var getAccountInfo=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var accountList,tempContractIn,newBalanceIn,allowance,tempContractOut,newBalanceOut;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!tokens){_context6.next=24;break;}_context6.next=3;return selectedProvider.listAccounts();case 3:accountList=_context6.sent;if(!tokenIn){_context6.next=18;break;}tempContractIn=new ethers.Contract(tokens[tokenIn].address,erc20Abi,selectedProvider);_context6.next=8;return getBalance(tokenIn,accountList[0],tempContractIn);case 8:newBalanceIn=_context6.sent;setBalanceIn(newBalanceIn);if(!(tokenIn===\"ETH\")){_context6.next=14;break;}setRouterAllowance();_context6.next=18;break;case 14:_context6.next=16;return makeCall(\"allowance\",tempContractIn,[accountList[0],ROUTER_ADDRESS]);case 16:allowance=_context6.sent;setRouterAllowance(allowance);case 18:if(!tokenOut){_context6.next=24;break;}tempContractOut=new ethers.Contract(tokens[tokenOut].address,erc20Abi,selectedProvider);_context6.next=22;return getBalance(tokenOut,accountList[0],tempContractOut);case 22:newBalanceOut=_context6.sent;setBalanceOut(newBalanceOut);case 24:case\"end\":return _context6.stop();}}},_callee6);}));return function getAccountInfo(){return _ref7.apply(this,arguments);};}();usePoller(getAccountInfo,6000);var route=trades?trades.length>0?trades[0].route.path.map(function(item){return item.symbol;}):[]:[];var updateRouterAllowance=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(newAllowance){var tempContract,result;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:setApproving(true);_context7.prev=1;tempContract=new ethers.Contract(tokens[tokenIn].address,erc20Abi,signer);_context7.next=5;return makeCall(\"approve\",tempContract,[ROUTER_ADDRESS,newAllowance]);case 5:result=_context7.sent;console.log(result);setApproving(false);return _context7.abrupt(\"return\",true);case 11:_context7.prev=11;_context7.t0=_context7[\"catch\"](1);notification.open({message:\"Approval unsuccessful\",description:\"Error: \".concat(_context7.t0.message)});case 14:case\"end\":return _context7.stop();}}},_callee7,null,[[1,11]]);}));return function updateRouterAllowance(_x8){return _ref8.apply(this,arguments);};}();var approveRouter=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var approvalAmount,approval;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:approvalAmount=exact===\"in\"?ethers.utils.hexlify(ethers.utils.parseUnits(amountIn.toString(),tokens[tokenIn].decimals)):amountInMax.raw.toString();console.log(approvalAmount);approval=updateRouterAllowance(approvalAmount);if(approval){notification.open({message:\"Token transfer approved\",description:\"You can now swap up to \".concat(amountIn,\" \").concat(tokenIn)});}case 4:case\"end\":return _context8.stop();}}},_callee8);}));return function approveRouter(){return _ref9.apply(this,arguments);};}();var removeRouterAllowance=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var approvalAmount,removal;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:approvalAmount=ethers.utils.hexlify(0);console.log(approvalAmount);removal=updateRouterAllowance(approvalAmount);if(removal){notification.open({message:\"Token approval removed\",description:\"The router is no longer approved for \".concat(tokenIn)});}case 4:case\"end\":return _context9.stop();}}},_callee9);}));return function removeRouterAllowance(){return _ref10.apply(this,arguments);};}();var executeSwap=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){var args,metadata,call,deadline,path,accountList,address,_amountIn,_amountOutMin,_amountOut,_amountInMax,result;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:setSwapping(true);_context10.prev=1;metadata={};deadline=Math.floor(Date.now()/1000)+timeLimit;path=trades[0].route.path.map(function(item){return item.address;});console.log(path);_context10.next=8;return selectedProvider.listAccounts();case 8:accountList=_context10.sent;address=accountList[0];if(exact===\"in\"){_amountIn=ethers.utils.hexlify(ethers.utils.parseUnits(amountIn.toString(),tokens[tokenIn].decimals));_amountOutMin=ethers.utils.hexlify(ethers.BigNumber.from(amountOutMin.raw.toString()));if(tokenIn===\"ETH\"){call=\"swapExactETHForTokens\";args=[_amountOutMin,path,address,deadline];metadata.value=_amountIn;}else{call=tokenOut===\"ETH\"?\"swapExactTokensForETH\":\"swapExactTokensForTokens\";args=[_amountIn,_amountOutMin,path,address,deadline];}}else if(exact===\"out\"){_amountOut=ethers.utils.hexlify(ethers.utils.parseUnits(amountOut.toString(),tokens[tokenOut].decimals));_amountInMax=ethers.utils.hexlify(ethers.BigNumber.from(amountInMax.raw.toString()));if(tokenIn===\"ETH\"){call=\"swapETHForExactTokens\";args=[_amountOut,path,address,deadline];metadata.value=_amountInMax;}else{call=tokenOut===\"ETH\"?\"swapTokensForExactETH\":\"swapTokensForExactTokens\";args=[_amountOut,_amountInMax,path,address,deadline];}}console.log(call,args,metadata);_context10.next=14;return makeCall(call,routerContract,args,metadata);case 14:result=_context10.sent;console.log(result);notification.open({message:\"Swap complete ðŸ¦„\",description:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:\"Swapped \".concat(tokenIn,\" for \").concat(tokenOut,\", transaction: \")}),/*#__PURE__*/_jsx(Text,{copyable:true,children:result.hash})]})});setSwapping(false);_context10.next=25;break;case 20:_context10.prev=20;_context10.t0=_context10[\"catch\"](1);console.log(_context10.t0);setSwapping(false);notification.open({message:\"Swap unsuccessful\",description:\"Error: \".concat(_context10.t0.message)});case 25:case\"end\":return _context10.stop();}}},_callee10,null,[[1,20]]);}));return function executeSwap(){return _ref11.apply(this,arguments);};}();var showSwapModal=function showSwapModal(){setSwapModalVisible(true);};var handleSwapModalOk=function handleSwapModalOk(){setSwapModalVisible(false);executeSwap();};var handleSwapModalCancel=function handleSwapModalCancel(){setSwapModalVisible(false);};var insufficientBalance=balanceIn?parseFloat(ethers.utils.formatUnits(balanceIn,tokens[tokenIn].decimals))<amountIn:null;var inputIsToken=tokenIn!==\"ETH\";var insufficientAllowance=!inputIsToken?false:routerAllowance?parseFloat(ethers.utils.formatUnits(routerAllowance,tokens[tokenIn].decimals))<amountIn:null;var formattedBalanceIn=balanceIn?parseFloat(ethers.utils.formatUnits(balanceIn,tokens[tokenIn].decimals)).toPrecision(6):null;var formattedBalanceOut=balanceOut?parseFloat(ethers.utils.formatUnits(balanceOut,tokens[tokenOut].decimals)).toPrecision(6):null;var metaIn=tokens&&tokenList&&tokenIn?tokenList.filter(function(t){return t.address===tokens[tokenIn].address;})[0]:null;var metaOut=tokens&&tokenList&&tokenOut?tokenList.filter(function(t){return t.address===tokens[tokenOut].address;})[0]:null;var cleanIpfsURI=function cleanIpfsURI(uri){try{return uri.replace(\"ipfs://\",\"https://ipfs.io/ipfs/\");}catch(e){console.log(e,uri);return uri;}};var logoIn=metaIn?cleanIpfsURI(metaIn.logoURI):null;var logoOut=metaOut?cleanIpfsURI(metaOut.logoURI):null;var rawPrice=trades&&trades[0]?trades[0].executionPrice:null;var price=rawPrice?rawPrice.toSignificant(7):null;var priceDescription=rawPrice?invertPrice?\"\".concat(rawPrice.invert().toSignificant(7),\" \").concat(tokenIn,\" per \").concat(tokenOut):\"\".concat(price,\" \").concat(tokenOut,\" per \").concat(tokenIn):null;var priceWidget=/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:priceDescription}),/*#__PURE__*/_jsx(Button,{type:\"text\",onClick:function onClick(){setInvertPrice(!invertPrice);},children:/*#__PURE__*/_jsx(RetweetOutlined,{})})]});var swapModal=/*#__PURE__*/_jsxs(Modal,{title:\"Confirm swap\",visible:swapModalVisible,onOk:handleSwapModalOk,onCancel:handleSwapModalCancel,children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"img\",{src:logoIn,alt:tokenIn,width:\"30\"}),amountIn,tokenIn]})}),/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",style:{width:30},children:/*#__PURE__*/_jsx(\"span\",{children:\"\\u2193\"})}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"img\",{src:logoOut,alt:tokenOut,width:\"30\"}),amountOut,tokenOut]})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Row,{children:priceWidget}),/*#__PURE__*/_jsx(Row,{children:trades&&(amountOutMin&&exact===\"in\"||amountInMax&&exact===\"out\")?exact===\"in\"?\"Output is estimated. You will receive at least \".concat(amountOutMin.toSignificant(6),\" \").concat(tokenOut,\" or the transaction will revert.\"):\"Input is estimated. You will sell at most \".concat(amountInMax.toSignificant(6),\" \").concat(tokenIn,\" or the transaction will revert.\"):null})]});return/*#__PURE__*/_jsxs(Card,{title:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://ipfs.io/ipfs/QmXttGpZrECX5qCyXbBQiqgQNytVGeZW5Anewvh2jc4psg\",width:\"40\",alt:\"uniswapLogo\"}),/*#__PURE__*/_jsx(Typography,{children:\"Uniswapper\"})]}),extra:/*#__PURE__*/_jsx(Button,{type:\"text\",onClick:function onClick(){setSettingsVisible(true);},children:/*#__PURE__*/_jsx(SettingOutlined,{})}),children:[/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",children:[/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",children:/*#__PURE__*/_jsxs(Card,{size:\"small\",type:\"inner\",title:\"From\".concat(exact===\"out\"&&tokenIn&&tokenOut?\" (estimate)\":\"\"),extra:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"img\",{src:logoIn,alt:tokenIn,width:\"30\"}),/*#__PURE__*/_jsx(Button,{type:\"link\",onClick:function onClick(){setAmountOut();setAmountIn(ethers.utils.formatUnits(balanceIn,tokens[tokenIn].decimals));setAmountOutMin();setAmountInMax();setExact(\"in\");},children:formattedBalanceIn})]}),style:{width:400,textAlign:\"left\"},children:[/*#__PURE__*/_jsx(InputNumber,{style:{width:\"160px\"},min:0,size:\"large\",value:amountIn,onChange:function onChange(e){setAmountOut();setTrades();setAmountIn(e);setExact(\"in\");}}),/*#__PURE__*/_jsx(Select,{showSearch:true,value:tokenIn,style:{width:\"120px\"},size:\"large\",bordered:false,defaultValue:defaultToken,onChange:function onChange(value){console.log(value);if(value===tokenOut){console.log(\"switch!\",tokenIn);setTokenOut(tokenIn);setAmountOut(amountIn);setBalanceOut(balanceIn);}setTokenIn(value);setTrades();setAmountIn();setExact(\"out\");setBalanceIn();},filterOption:function filterOption(input,option){return option.children.toLowerCase().indexOf(input.toLowerCase())>=0;},optionFilterProp:\"children\",children:tokenList.map(function(token){return/*#__PURE__*/_jsx(Option,{value:token.symbol,children:token.symbol},token.symbol);})})]})}),/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",children:/*#__PURE__*/_jsx(Tooltip,{title:route.join(\"->\"),children:/*#__PURE__*/_jsx(\"span\",{children:\"\\u2193\"})})}),/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",children:/*#__PURE__*/_jsxs(Card,{size:\"small\",type:\"inner\",title:\"To\".concat(exact===\"in\"&&tokenIn&&tokenOut?\" (estimate)\":\"\"),extra:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"img\",{src:logoOut,width:\"30\",alt:tokenOut}),/*#__PURE__*/_jsx(Button,{type:\"text\",children:formattedBalanceOut})]}),style:{width:400,textAlign:\"left\"},children:[/*#__PURE__*/_jsx(InputNumber,{style:{width:\"160px\"},size:\"large\",min:0,value:amountOut,onChange:function onChange(e){setAmountOut(e);setAmountIn();setTrades();setExact(\"out\");}}),/*#__PURE__*/_jsx(Select,{showSearch:true,value:tokenOut,style:{width:\"120px\"},size:\"large\",bordered:false,onChange:function onChange(value){console.log(value,tokenIn,tokenOut);if(value===tokenIn){console.log(\"switch!\",tokenOut);setTokenIn(tokenOut);setAmountIn(amountOut);setBalanceIn(balanceOut);}setTokenOut(value);setExact(\"in\");setAmountOut();setTrades();setBalanceOut();},filterOption:function filterOption(input,option){return option.children.toLowerCase().indexOf(input.toLowerCase())>=0;},optionFilterProp:\"children\",children:tokenList.map(function(token){return/*#__PURE__*/_jsx(Option,{value:token.symbol,children:token.symbol},token.symbol);})})]})}),/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",children:priceDescription?priceWidget:null}),/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",children:/*#__PURE__*/_jsxs(Space,{children:[inputIsToken?/*#__PURE__*/_jsx(Button,{size:\"large\",loading:approving,disabled:!insufficientAllowance,onClick:approveRouter,children:!insufficientAllowance&&amountIn&&amountOut?\"Approved\":\"Approve\"}):null,/*#__PURE__*/_jsx(Button,{size:\"large\",loading:swapping,disabled:insufficientAllowance||insufficientBalance||!amountIn||!amountOut,onClick:showSwapModal,children:insufficientBalance?\"Insufficient balance\":\"Swap!\"}),swapModal]})})]}),/*#__PURE__*/_jsx(Drawer,{visible:settingsVisible,onClose:function onClose(){setSettingsVisible(false);},width:500,children:/*#__PURE__*/_jsxs(Descriptions,{title:\"Details\",column:1,style:{textAlign:\"left\"},children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:\"blockNumber\",children:blockNumber}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"routerAllowance\",children:/*#__PURE__*/_jsxs(Space,{children:[routerAllowance?ethers.utils.formatUnits(routerAllowance,tokens[tokenIn].decimals):null,routerAllowance>0?/*#__PURE__*/_jsx(Button,{onClick:removeRouterAllowance,children:\"Remove Allowance\"}):null]})}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"route\",children:route.join(\"->\")}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"exact\",children:exact}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"bestPrice\",children:trades?trades.length>0?trades[0].executionPrice.toSignificant(6):null:null}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"nextMidPrice\",children:trades?trades.length>0?trades[0].nextMidPrice.toSignificant(6):null:null}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"priceImpact\",children:trades?trades.length>0?trades[0].priceImpact.toSignificant(6):null:null}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"slippageTolerance\",children:/*#__PURE__*/_jsx(InputNumber,{defaultValue:defaultSlippage,min:0,max:100,precision:2,formatter:function formatter(value){return\"\".concat(value,\"%\");},parser:function parser(value){return value.replace(\"%\",\"\");},onChange:function onChange(value){console.log(value);var slippagePercent=new Percent(Math.round(value*100).toString(),\"10000\");setSlippageTolerance(slippagePercent);}})}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"amountInMax\",children:amountInMax?amountInMax.toExact():null}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"amountOutMin\",children:amountOutMin?amountOutMin.toExact():null}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"timeLimitInSeconds\",children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:3600,defaultValue:defaultTimeLimit,onChange:function onChange(value){console.log(value);setTimeLimit(value);}})})]})})]});}export default Swap;","map":{"version":3,"sources":["C:/Users/KINSHUK/Desktop/ETH/qd-off-chain-voters-and-candidates/packages/react-app/src/components/Swap.jsx"],"names":["RetweetOutlined","SettingOutlined","ChainId","Fetcher","Percent","Token","TokenAmount","Trade","WETH","abi","IUniswapV2Router02ABI","Button","Card","Descriptions","Divider","Drawer","InputNumber","Modal","notification","Row","Select","Space","Tooltip","Typography","useBlockNumber","usePoller","ethers","React","useEffect","useState","useDebounce","Option","Text","ROUTER_ADDRESS","ZERO_ADDRESS","erc20Abi","makeCall","callName","contract","args","metadata","result","console","log","defaultToken","defaultTokenOut","defaultSlippage","defaultTimeLimit","tokenListToObject","array","reduce","obj","item","symbol","chainId","address","decimals","name","Swap","selectedProvider","tokenListURI","tokenIn","setTokenIn","tokenOut","setTokenOut","exact","setExact","amountIn","setAmountIn","amountInMax","setAmountInMax","amountOut","setAmountOut","amountOutMin","setAmountOutMin","trades","setTrades","routerAllowance","setRouterAllowance","balanceIn","setBalanceIn","balanceOut","setBalanceOut","Math","round","toString","slippageTolerance","setSlippageTolerance","timeLimit","setTimeLimit","swapping","setSwapping","approving","setApproving","settingsVisible","setSettingsVisible","swapModalVisible","setSwapModalVisible","tokenList","setTokenList","tokens","setTokens","invertPrice","setInvertPrice","blockNumber","signer","getSigner","routerContract","Contract","_tokenListUri","debouncedAmountIn","debouncedAmountOut","activeChainId","process","env","REACT_APP_NETWORK","KOVAN","MAINNET","getTokenList","fetch","json","tokenListJson","filteredTokens","filter","t","ethToken","logoURI","_tokenList","_tokens","getTrades","pairs","arr","map","v","i","slice","w","flat","baseTokens","includes","el","listOfPairwiseTokens","getPairs","list","listOfPromises","fetchPairData","Promise","all","p","catch","undefined","listOfPairs","bestTrade","bestTradeExactIn","utils","parseUnits","maxNumResults","maxHops","outputAmount","toSignificant","bestTradeExactOut","inputAmount","minimumAmountOut","maximumAmountIn","getBalance","_token","_account","_contract","newBalance","getAccountInfo","listAccounts","accountList","tempContractIn","newBalanceIn","allowance","tempContractOut","newBalanceOut","route","length","path","updateRouterAllowance","newAllowance","tempContract","open","message","description","approveRouter","approvalAmount","hexlify","raw","approval","removeRouterAllowance","removal","executeSwap","deadline","floor","Date","now","_amountIn","_amountOutMin","BigNumber","from","call","value","_amountOut","_amountInMax","hash","showSwapModal","handleSwapModalOk","handleSwapModalCancel","insufficientBalance","parseFloat","formatUnits","inputIsToken","insufficientAllowance","formattedBalanceIn","toPrecision","formattedBalanceOut","metaIn","metaOut","cleanIpfsURI","uri","replace","e","logoIn","logoOut","rawPrice","executionPrice","price","priceDescription","invert","priceWidget","swapModal","width","textAlign","input","option","children","toLowerCase","indexOf","token","join","nextMidPrice","priceImpact","slippagePercent","toExact"],"mappings":"6tBAAA,OAASA,eAAT,CAA0BC,eAA1B,KAAiD,mBAAjD,CACA,OAASC,OAAT,CAAkBC,OAAlB,CAA2BC,OAA3B,CAAoCC,KAApC,CAA2CC,WAA3C,CAAwDC,KAAxD,CAA+DC,IAA/D,KAA2E,cAA3E,CACA,OAASC,GAAG,GAAIC,CAAAA,qBAAhB,KAA6C,qDAA7C,CACA,OACEC,MADF,CAEEC,IAFF,CAGEC,YAHF,CAIEC,OAJF,CAKEC,MALF,CAMEC,WANF,CAOEC,KAPF,CAQEC,YARF,CASEC,GATF,CAUEC,MAVF,CAWEC,KAXF,CAYEC,OAZF,CAaEC,UAbF,KAcO,MAdP,CAeA,OAASC,cAAT,CAAyBC,SAAzB,KAA0C,WAA1C,CACA,OAASC,MAAT,KAAuB,QAAvB,CACA,MAAOC,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,KAA2C,OAA3C,CACA,OAASC,WAAT,KAA4B,UAA5B,C,6IAEA,GAAQC,CAAAA,MAAR,CAAmBX,MAAnB,CAAQW,MAAR,CACA,GAAQC,CAAAA,IAAR,CAAiBT,UAAjB,CAAQS,IAAR,CAEA,MAAO,IAAMC,CAAAA,cAAc,CAAG,4CAAvB,CAEP,MAAO,IAAMC,CAAAA,YAAY,CAAG,4CAArB,CAEP,GAAMC,CAAAA,QAAQ,CAAG,CACf,0DADe,CAEf,kFAFe,CAGf,8FAHe,CAAjB,CAMA,GAAMC,CAAAA,QAAQ,0FAAG,iBAAOC,QAAP,CAAiBC,QAAjB,CAA2BC,IAA3B,sJAAiCC,QAAjC,+CAA4C,EAA5C,KACXF,QAAQ,CAACD,QAAD,CADG,8BAGTE,IAHS,+CAIID,CAAAA,QAAQ,CAACD,QAAD,CAAR,OAAAC,QAAQ,oBAAcC,IAAd,UAAoBC,QAApB,GAJZ,QAIXC,MAJW,oEAMIH,CAAAA,QAAQ,CAACD,QAAD,CAAR,EANJ,SAMXI,MANW,uDAQNA,MARM,UAUfC,OAAO,CAACC,GAAR,CAAY,uBAAZ,EAVe,uDAAH,kBAARP,CAAAA,QAAQ,oDAAd,CAaA,GAAMQ,CAAAA,YAAY,CAAG,KAArB,CACA,GAAMC,CAAAA,eAAe,CAAG,KAAxB,CACA,GAAMC,CAAAA,eAAe,CAAG,KAAxB,CACA,GAAMC,CAAAA,gBAAgB,CAAG,GAAK,EAA9B,CAEA,GAAMC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAAAC,KAAK,QAC7BA,CAAAA,KAAK,CAACC,MAAN,CAAa,SAACC,GAAD,CAAMC,IAAN,CAAe,CAC1BD,GAAG,CAACC,IAAI,CAACC,MAAN,CAAH,CAAmB,GAAIhD,CAAAA,KAAJ,CAAU+C,IAAI,CAACE,OAAf,CAAwBF,IAAI,CAACG,OAA7B,CAAsCH,IAAI,CAACI,QAA3C,CAAqDJ,IAAI,CAACC,MAA1D,CAAkED,IAAI,CAACK,IAAvE,CAAnB,CACA,MAAON,CAAAA,GAAP,CACD,CAHD,CAGG,EAHH,CAD6B,EAA/B,CAMA,QAASO,CAAAA,IAAT,OAAkD,IAAlCC,CAAAA,gBAAkC,OAAlCA,gBAAkC,CAAhBC,YAAgB,OAAhBA,YAAgB,CAChD,cAA8B/B,QAAQ,CAACe,YAAD,CAAtC,wCAAOiB,OAAP,eAAgBC,UAAhB,eACA,eAAgCjC,QAAQ,CAACgB,eAAD,CAAxC,yCAAOkB,QAAP,eAAiBC,WAAjB,eACA,eAA0BnC,QAAQ,EAAlC,yCAAOoC,KAAP,eAAcC,QAAd,eACA,eAAgCrC,QAAQ,EAAxC,yCAAOsC,QAAP,eAAiBC,WAAjB,eACA,eAAsCvC,QAAQ,EAA9C,0CAAOwC,WAAP,gBAAoBC,cAApB,gBACA,gBAAkCzC,QAAQ,EAA1C,2CAAO0C,SAAP,gBAAkBC,YAAlB,gBACA,gBAAwC3C,QAAQ,EAAhD,2CAAO4C,YAAP,gBAAqBC,eAArB,gBACA,gBAA4B7C,QAAQ,EAApC,2CAAO8C,MAAP,gBAAeC,SAAf,gBACA,gBAA8C/C,QAAQ,EAAtD,2CAAOgD,eAAP,gBAAwBC,kBAAxB,gBACA,gBAAkCjD,QAAQ,EAA1C,2CAAOkD,SAAP,gBAAkBC,YAAlB,gBACA,gBAAoCnD,QAAQ,EAA5C,2CAAOoD,UAAP,gBAAmBC,aAAnB,gBACA,gBAAkDrD,QAAQ,CACxD,GAAIzB,CAAAA,OAAJ,CAAY+E,IAAI,CAACC,KAAL,CAAWtC,eAAe,CAAG,GAA7B,EAAkCuC,QAAlC,EAAZ,CAA0D,OAA1D,CADwD,CAA1D,2CAAOC,iBAAP,gBAA0BC,oBAA1B,gBAGA,gBAAkC1D,QAAQ,CAACkB,gBAAD,CAA1C,2CAAOyC,SAAP,gBAAkBC,YAAlB,gBACA,gBAAgC5D,QAAQ,CAAC,KAAD,CAAxC,2CAAO6D,QAAP,gBAAiBC,WAAjB,gBACA,gBAAkC9D,QAAQ,CAAC,KAAD,CAA1C,2CAAO+D,SAAP,gBAAkBC,YAAlB,gBACA,gBAA8ChE,QAAQ,CAAC,KAAD,CAAtD,2CAAOiE,eAAP,gBAAwBC,kBAAxB,gBACA,gBAAgDlE,QAAQ,CAAC,KAAD,CAAxD,2CAAOmE,gBAAP,gBAAyBC,mBAAzB,gBAEA,gBAAkCpE,QAAQ,CAAC,EAAD,CAA1C,2CAAOqE,SAAP,gBAAkBC,YAAlB,gBAEA,gBAA4BtE,QAAQ,EAApC,2CAAOuE,MAAP,gBAAeC,SAAf,gBAEA,gBAAsCxE,QAAQ,CAAC,KAAD,CAA9C,2CAAOyE,WAAP,gBAAoBC,cAApB,gBAEA,GAAMC,CAAAA,WAAW,CAAGhF,cAAc,CAACmC,gBAAD,CAAmB,IAAnB,CAAlC,CAEA,GAAM8C,CAAAA,MAAM,CAAG9C,gBAAgB,CAAC+C,SAAjB,EAAf,CACA,GAAMC,CAAAA,cAAc,CAAG,GAAIjF,CAAAA,MAAM,CAACkF,QAAX,CAAoB3E,cAApB,CAAoCvB,qBAApC,CAA2D+F,MAA3D,CAAvB,CAEA,GAAMI,CAAAA,aAAa,CAAGjD,YAAY,EAAI,iDAAtC,CAEA,GAAMkD,CAAAA,iBAAiB,CAAGhF,WAAW,CAACqC,QAAD,CAAW,GAAX,CAArC,CACA,GAAM4C,CAAAA,kBAAkB,CAAGjF,WAAW,CAACyC,SAAD,CAAY,GAAZ,CAAtC,CAEA,GAAMyC,CAAAA,aAAa,CAAGC,OAAO,CAACC,GAAR,CAAYC,iBAAZ,GAAkC,OAAlC,CAA4CjH,OAAO,CAACkH,KAApD,CAA4DlH,OAAO,CAACmH,OAA1F,CAEAzF,SAAS,CAAC,UAAM,CACd,GAAM0F,CAAAA,YAAY,2FAAG,iNACnB5E,OAAO,CAACC,GAAR,CAAYkE,aAAZ,EADmB,wCAGOU,CAAAA,KAAK,CAACV,aAAD,CAHZ,QAGXX,WAHW,uCAIWA,CAAAA,WAAS,CAACsB,IAAV,EAJX,QAIXC,aAJW,gBAKXC,cALW,CAKMD,aAAa,CAACrB,MAAd,CAAqBuB,MAArB,CAA4B,SAAUC,CAAV,CAAa,CAC9D,MAAOA,CAAAA,CAAC,CAACtE,OAAF,GAAc0D,aAArB,CACD,CAFsB,CALN,CAQXa,QARW,CAQArH,IAAI,CAACwG,aAAD,CARJ,CASjBa,QAAQ,CAACpE,IAAT,CAAgB,UAAhB,CACAoE,QAAQ,CAACxE,MAAT,CAAkB,KAAlB,CACAwE,QAAQ,CAACC,OAAT,CACE,6IADF,CAEMC,UAbW,EAaGF,QAbH,4BAagBH,cAbhB,GAcjBvB,YAAY,CAAC4B,UAAD,CAAZ,CACMC,OAfW,CAeDhF,iBAAiB,CAAC+E,UAAD,CAfhB,CAgBjB1B,SAAS,CAAC2B,OAAD,CAAT,CAhBiB,qFAkBjBtF,OAAO,CAACC,GAAR,eAlBiB,uEAAH,kBAAZ2E,CAAAA,YAAY,2CAAlB,CAqBAA,YAAY,GACb,CAvBQ,CAuBN,CAAC1D,YAAD,CAvBM,CAAT,CAyBA,GAAMqE,CAAAA,SAAS,2FAAG,sNACZpE,OAAO,EAAIE,QAAX,GAAwBI,QAAQ,EAAII,SAApC,CADY,4BAER2D,KAFQ,CAEA,QAARA,CAAAA,KAAQ,CAAAC,GAAG,QAAIA,CAAAA,GAAG,CAACC,GAAJ,CAAQ,SAACC,CAAD,CAAIC,CAAJ,QAAUH,CAAAA,GAAG,CAACI,KAAJ,CAAUD,CAAC,CAAG,CAAd,EAAiBF,GAAjB,CAAqB,SAAAI,CAAC,QAAI,CAACH,CAAD,CAAIG,CAAJ,CAAJ,EAAtB,CAAV,EAAR,EAAqDC,IAArD,EAAJ,EAFH,CAIRC,UAJQ,CAIKxC,SAAS,CACzByB,MADgB,CACT,SAAUC,CAAV,CAAa,CACnB,MAAO,CAAC,KAAD,CAAQ,MAAR,CAAgB,MAAhB,CAAwB,MAAxB,CAAgC,KAAhC,CAAuC,KAAvC,CAA8C,MAA9C,CAAsD/D,OAAtD,CAA+DE,QAA/D,EAAyE4E,QAAzE,CAAkFf,CAAC,CAACvE,MAApF,CAAP,CACD,CAHgB,EAIhB+E,GAJgB,CAIZ,SAAAQ,EAAE,CAAI,CACT,MAAO,IAAIvI,CAAAA,KAAJ,CAAUuI,EAAE,CAACtF,OAAb,CAAsBsF,EAAE,CAACrF,OAAzB,CAAkCqF,EAAE,CAACpF,QAArC,CAA+CoF,EAAE,CAACvF,MAAlD,CAA0DuF,EAAE,CAACnF,IAA7D,CAAP,CACD,CANgB,CAJL,CAYRoF,oBAZQ,CAYeX,KAAK,CAACQ,UAAD,CAZpB,CAcRI,QAdQ,2FAcG,kBAAMC,IAAN,yIACTC,cADS,CACQD,IAAI,CAACX,GAAL,CAAS,SAAAhF,IAAI,QAAIjD,CAAAA,OAAO,CAAC8I,aAAR,CAAsB7F,IAAI,CAAC,CAAD,CAA1B,CAA+BA,IAAI,CAAC,CAAD,CAAnC,CAAwCO,gBAAxC,CAAJ,EAAb,CADR,kCAERuF,OAAO,CAACC,GAAR,CAAYH,cAAc,CAACZ,GAAf,CAAmB,SAAAgB,CAAC,QAAIA,CAAAA,CAAC,CAACC,KAAF,CAAQ,iBAAMC,CAAAA,SAAN,EAAR,CAAJ,EAApB,CAAZ,CAFQ,0DAdH,kBAcRR,CAAAA,QAdQ,sEAmBYA,CAAAA,QAAQ,CAACD,oBAAD,CAnBpB,QAmBRU,WAnBQ,gBAuBd,GAAItF,KAAK,GAAK,IAAd,CAAoB,CAClBK,cAAc,GACdkF,SAAS,CAAGjJ,KAAK,CAACkJ,gBAAN,CACVF,WAAW,CAAC5B,MAAZ,CAAmB,SAAAvE,IAAI,QAAIA,CAAAA,IAAJ,EAAvB,CADU,CAEV,GAAI9C,CAAAA,WAAJ,CAAgB8F,MAAM,CAACvC,OAAD,CAAtB,CAAiCnC,MAAM,CAACgI,KAAP,CAAaC,UAAb,CAAwBxF,QAAQ,CAACkB,QAAT,EAAxB,CAA6Ce,MAAM,CAACvC,OAAD,CAAN,CAAgBL,QAA7D,CAAjC,CAFU,CAGV4C,MAAM,CAACrC,QAAD,CAHI,CAIV,CAAE6F,aAAa,CAAE,CAAjB,CAAoBC,OAAO,CAAE,CAA7B,CAJU,CAAZ,CAMA,GAAIL,SAAS,CAAC,CAAD,CAAb,CAAkB,CAChBhF,YAAY,CAACgF,SAAS,CAAC,CAAD,CAAT,CAAaM,YAAb,CAA0BC,aAA1B,CAAwC,CAAxC,CAAD,CAAZ,CACD,CAFD,IAEO,CACLvF,YAAY,GACb,CACF,CAbD,IAaO,IAAIP,KAAK,GAAK,KAAd,CAAqB,CAC1BS,eAAe,GACf8E,SAAS,CAAGjJ,KAAK,CAACyJ,iBAAN,CACVT,WAAW,CAAC5B,MAAZ,CAAmB,SAAAvE,IAAI,QAAIA,CAAAA,IAAJ,EAAvB,CADU,CAEVgD,MAAM,CAACvC,OAAD,CAFI,CAGV,GAAIvD,CAAAA,WAAJ,CAAgB8F,MAAM,CAACrC,QAAD,CAAtB,CAAkCrC,MAAM,CAACgI,KAAP,CAAaC,UAAb,CAAwBpF,SAAS,CAACc,QAAV,EAAxB,CAA8Ce,MAAM,CAACrC,QAAD,CAAN,CAAiBP,QAA/D,CAAlC,CAHU,CAIV,CAAEoG,aAAa,CAAE,CAAjB,CAAoBC,OAAO,CAAE,CAA7B,CAJU,CAAZ,CAMA,GAAIL,SAAS,CAAC,CAAD,CAAb,CAAkB,CAChBpF,WAAW,CAACoF,SAAS,CAAC,CAAD,CAAT,CAAaS,WAAb,CAAyBF,aAAzB,CAAuC,CAAvC,CAAD,CAAX,CACD,CAFD,IAEO,CACL3F,WAAW,GACZ,CACF,CAEDQ,SAAS,CAAC4E,SAAD,CAAT,CAEA9G,OAAO,CAACC,GAAR,CAAY6G,SAAZ,EArDc,yDAAH,kBAATvB,CAAAA,SAAS,2CAAf,CAyDArG,SAAS,CAAC,UAAM,CACdqG,SAAS,GACV,CAFQ,CAEN,CAACpE,OAAD,CAAUE,QAAV,CAAoB+C,iBAApB,CAAuCC,kBAAvC,CAA2DzB,iBAA3D,CAA8E3B,gBAA9E,CAFM,CAAT,CAIA/B,SAAS,CAAC,UAAM,CACd,GAAI+C,MAAM,EAAIA,MAAM,CAAC,CAAD,CAApB,CAAyB,CACvB,GAAIV,KAAK,GAAK,IAAd,CAAoB,CAClBS,eAAe,CAACC,MAAM,CAAC,CAAD,CAAN,CAAUuF,gBAAV,CAA2B5E,iBAA3B,CAAD,CAAf,CACD,CAFD,IAEO,IAAIrB,KAAK,GAAK,KAAd,CAAqB,CAC1BK,cAAc,CAACK,MAAM,CAAC,CAAD,CAAN,CAAUwF,eAAV,CAA0B7E,iBAA1B,CAAD,CAAd,CACD,CACF,CACF,CARQ,CAQN,CAACA,iBAAD,CAAoBnB,QAApB,CAA8BI,SAA9B,CAAyCI,MAAzC,CARM,CAAT,CAUA,GAAMyF,CAAAA,UAAU,2FAAG,kBAAOC,MAAP,CAAeC,QAAf,CAAyBC,SAAzB,0IAEbF,MAAM,GAAK,KAFE,kDAGI1G,CAAAA,gBAAgB,CAACyG,UAAjB,CAA4BE,QAA5B,CAHJ,QAGfE,UAHe,qEAKIpI,CAAAA,QAAQ,CAAC,WAAD,CAAcmI,SAAd,CAAyB,CAACD,QAAD,CAAzB,CALZ,QAKfE,UALe,wDAOVA,UAPU,2DAAH,kBAAVJ,CAAAA,UAAU,sDAAhB,CAUA,GAAMK,CAAAA,cAAc,2FAAG,gOACjBrE,MADiB,kDAEOzC,CAAAA,gBAAgB,CAAC+G,YAAjB,EAFP,QAEbC,WAFa,oBAIf9G,OAJe,2BAKX+G,cALW,CAKM,GAAIlJ,CAAAA,MAAM,CAACkF,QAAX,CAAoBR,MAAM,CAACvC,OAAD,CAAN,CAAgBN,OAApC,CAA6CpB,QAA7C,CAAuDwB,gBAAvD,CALN,wBAMUyG,CAAAA,UAAU,CAACvG,OAAD,CAAU8G,WAAW,CAAC,CAAD,CAArB,CAA0BC,cAA1B,CANpB,QAMXC,YANW,gBAOjB7F,YAAY,CAAC6F,YAAD,CAAZ,CAPiB,KAWbhH,OAAO,GAAK,KAXC,4BAYfiB,kBAAkB,GAZH,wDAcG1C,CAAAA,QAAQ,CAAC,WAAD,CAAcwI,cAAd,CAA8B,CAACD,WAAW,CAAC,CAAD,CAAZ,CAAiB1I,cAAjB,CAA9B,CAdX,SAcf6I,SAde,gBAefhG,kBAAkB,CAACgG,SAAD,CAAlB,CAfe,YAmBf/G,QAnBe,2BAoBXgH,eApBW,CAoBO,GAAIrJ,CAAAA,MAAM,CAACkF,QAAX,CAAoBR,MAAM,CAACrC,QAAD,CAAN,CAAiBR,OAArC,CAA8CpB,QAA9C,CAAwDwB,gBAAxD,CApBP,yBAqBWyG,CAAAA,UAAU,CAACrG,QAAD,CAAW4G,WAAW,CAAC,CAAD,CAAtB,CAA2BI,eAA3B,CArBrB,SAqBXC,aArBW,gBAsBjB9F,aAAa,CAAC8F,aAAD,CAAb,CAtBiB,yDAAH,kBAAdP,CAAAA,cAAc,2CAApB,CA2BAhJ,SAAS,CAACgJ,cAAD,CAAiB,IAAjB,CAAT,CAEA,GAAMQ,CAAAA,KAAK,CAAGtG,MAAM,CAChBA,MAAM,CAACuG,MAAP,CAAgB,CAAhB,CACEvG,MAAM,CAAC,CAAD,CAAN,CAAUsG,KAAV,CAAgBE,IAAhB,CAAqB/C,GAArB,CAAyB,SAAUhF,IAAV,CAAgB,CACvC,MAAOA,CAAAA,IAAI,CAACC,MAAZ,CACD,CAFD,CADF,CAIE,EALc,CAMhB,EANJ,CAQA,GAAM+H,CAAAA,qBAAqB,2FAAG,kBAAMC,YAAN,8IAC5BxF,YAAY,CAAC,IAAD,CAAZ,CAD4B,iBAGpByF,YAHoB,CAGL,GAAI5J,CAAAA,MAAM,CAACkF,QAAX,CAAoBR,MAAM,CAACvC,OAAD,CAAN,CAAgBN,OAApC,CAA6CpB,QAA7C,CAAuDsE,MAAvD,CAHK,wBAILrE,CAAAA,QAAQ,CAAC,SAAD,CAAYkJ,YAAZ,CAA0B,CAACrJ,cAAD,CAAiBoJ,YAAjB,CAA1B,CAJH,QAIpB5I,MAJoB,gBAK1BC,OAAO,CAACC,GAAR,CAAYF,MAAZ,EACAoD,YAAY,CAAC,KAAD,CAAZ,CAN0B,iCAOnB,IAPmB,+DAS1B3E,YAAY,CAACqK,IAAb,CAAkB,CAChBC,OAAO,CAAE,uBADO,CAEhBC,WAAW,kBAAY,aAAED,OAAd,CAFK,CAAlB,EAT0B,uEAAH,kBAArBJ,CAAAA,qBAAqB,8CAA3B,CAgBA,GAAMM,CAAAA,aAAa,2FAAG,oKACdC,cADc,CAElB1H,KAAK,GAAK,IAAV,CACIvC,MAAM,CAACgI,KAAP,CAAakC,OAAb,CAAqBlK,MAAM,CAACgI,KAAP,CAAaC,UAAb,CAAwBxF,QAAQ,CAACkB,QAAT,EAAxB,CAA6Ce,MAAM,CAACvC,OAAD,CAAN,CAAgBL,QAA7D,CAArB,CADJ,CAEIa,WAAW,CAACwH,GAAZ,CAAgBxG,QAAhB,EAJc,CAKpB3C,OAAO,CAACC,GAAR,CAAYgJ,cAAZ,EACMG,QANc,CAMHV,qBAAqB,CAACO,cAAD,CANlB,CAOpB,GAAIG,QAAJ,CAAc,CACZ5K,YAAY,CAACqK,IAAb,CAAkB,CAChBC,OAAO,CAAE,yBADO,CAEhBC,WAAW,kCAA4BtH,QAA5B,aAAwCN,OAAxC,CAFK,CAAlB,EAID,CAZmB,wDAAH,kBAAb6H,CAAAA,aAAa,2CAAnB,CAeA,GAAMK,CAAAA,qBAAqB,4FAAG,mKACtBJ,cADsB,CACLjK,MAAM,CAACgI,KAAP,CAAakC,OAAb,CAAqB,CAArB,CADK,CAE5BlJ,OAAO,CAACC,GAAR,CAAYgJ,cAAZ,EACMK,OAHsB,CAGZZ,qBAAqB,CAACO,cAAD,CAHT,CAI5B,GAAIK,OAAJ,CAAa,CACX9K,YAAY,CAACqK,IAAb,CAAkB,CAChBC,OAAO,CAAE,wBADO,CAEhBC,WAAW,gDAA0C5H,OAA1C,CAFK,CAAlB,EAID,CAT2B,wDAAH,kBAArBkI,CAAAA,qBAAqB,4CAA3B,CAYA,GAAME,CAAAA,WAAW,4FAAG,6PAClBtG,WAAW,CAAC,IAAD,CAAX,CADkB,kBAIVnD,QAJU,CAIC,EAJD,CAOV0J,QAPU,CAOC/G,IAAI,CAACgH,KAAL,CAAWC,IAAI,CAACC,GAAL,GAAa,IAAxB,EAAgC7G,SAPjC,CAQV2F,IARU,CAQHxG,MAAM,CAAC,CAAD,CAAN,CAAUsG,KAAV,CAAgBE,IAAhB,CAAqB/C,GAArB,CAAyB,SAAUhF,IAAV,CAAgB,CACpD,MAAOA,CAAAA,IAAI,CAACG,OAAZ,CACD,CAFY,CARG,CAWhBb,OAAO,CAACC,GAAR,CAAYwI,IAAZ,EAXgB,wBAYUxH,CAAAA,gBAAgB,CAAC+G,YAAjB,EAZV,QAYVC,WAZU,iBAaVpH,OAbU,CAaAoH,WAAW,CAAC,CAAD,CAbX,CAehB,GAAI1G,KAAK,GAAK,IAAd,CAAoB,CACZqI,SADY,CACA5K,MAAM,CAACgI,KAAP,CAAakC,OAAb,CAAqBlK,MAAM,CAACgI,KAAP,CAAaC,UAAb,CAAwBxF,QAAQ,CAACkB,QAAT,EAAxB,CAA6Ce,MAAM,CAACvC,OAAD,CAAN,CAAgBL,QAA7D,CAArB,CADA,CAEZ+I,aAFY,CAEI7K,MAAM,CAACgI,KAAP,CAAakC,OAAb,CAAqBlK,MAAM,CAAC8K,SAAP,CAAiBC,IAAjB,CAAsBhI,YAAY,CAACoH,GAAb,CAAiBxG,QAAjB,EAAtB,CAArB,CAFJ,CAGlB,GAAIxB,OAAO,GAAK,KAAhB,CAAuB,CACrB6I,IAAI,CAAG,uBAAP,CACAnK,IAAI,CAAG,CAACgK,aAAD,CAAgBpB,IAAhB,CAAsB5H,OAAtB,CAA+B2I,QAA/B,CAAP,CACA1J,QAAQ,CAACmK,KAAT,CAAiBL,SAAjB,CACD,CAJD,IAIO,CACLI,IAAI,CAAG3I,QAAQ,GAAK,KAAb,CAAqB,uBAArB,CAA+C,0BAAtD,CACAxB,IAAI,CAAG,CAAC+J,SAAD,CAAYC,aAAZ,CAA2BpB,IAA3B,CAAiC5H,OAAjC,CAA0C2I,QAA1C,CAAP,CACD,CACF,CAXD,IAWO,IAAIjI,KAAK,GAAK,KAAd,CAAqB,CACpB2I,UADoB,CACPlL,MAAM,CAACgI,KAAP,CAAakC,OAAb,CACjBlK,MAAM,CAACgI,KAAP,CAAaC,UAAb,CAAwBpF,SAAS,CAACc,QAAV,EAAxB,CAA8Ce,MAAM,CAACrC,QAAD,CAAN,CAAiBP,QAA/D,CADiB,CADO,CAIpBqJ,YAJoB,CAILnL,MAAM,CAACgI,KAAP,CAAakC,OAAb,CAAqBlK,MAAM,CAAC8K,SAAP,CAAiBC,IAAjB,CAAsBpI,WAAW,CAACwH,GAAZ,CAAgBxG,QAAhB,EAAtB,CAArB,CAJK,CAK1B,GAAIxB,OAAO,GAAK,KAAhB,CAAuB,CACrB6I,IAAI,CAAG,uBAAP,CACAnK,IAAI,CAAG,CAACqK,UAAD,CAAazB,IAAb,CAAmB5H,OAAnB,CAA4B2I,QAA5B,CAAP,CACA1J,QAAQ,CAACmK,KAAT,CAAiBE,YAAjB,CACD,CAJD,IAIO,CACLH,IAAI,CAAG3I,QAAQ,GAAK,KAAb,CAAqB,uBAArB,CAA+C,0BAAtD,CACAxB,IAAI,CAAG,CAACqK,UAAD,CAAaC,YAAb,CAA2B1B,IAA3B,CAAiC5H,OAAjC,CAA0C2I,QAA1C,CAAP,CACD,CACF,CACDxJ,OAAO,CAACC,GAAR,CAAY+J,IAAZ,CAAkBnK,IAAlB,CAAwBC,QAAxB,EAxCgB,yBAyCKJ,CAAAA,QAAQ,CAACsK,IAAD,CAAO/F,cAAP,CAAuBpE,IAAvB,CAA6BC,QAA7B,CAzCb,SAyCVC,MAzCU,iBA0ChBC,OAAO,CAACC,GAAR,CAAYF,MAAZ,EACAvB,YAAY,CAACqK,IAAb,CAAkB,CAChBC,OAAO,CAAE,kBADO,CAEhBC,WAAW,cACT,wCACE,KAAC,IAAD,6BAAkB5H,OAAlB,iBAAiCE,QAAjC,qBADF,cAEE,KAAC,IAAD,EAAM,QAAQ,KAAd,UAAgBtB,MAAM,CAACqK,IAAvB,EAFF,GAHc,CAAlB,EASAnH,WAAW,CAAC,KAAD,CAAX,CApDgB,yFAsDhBjD,OAAO,CAACC,GAAR,gBACAgD,WAAW,CAAC,KAAD,CAAX,CACAzE,YAAY,CAACqK,IAAb,CAAkB,CAChBC,OAAO,CAAE,mBADO,CAEhBC,WAAW,kBAAY,cAAED,OAAd,CAFK,CAAlB,EAxDgB,yEAAH,kBAAXS,CAAAA,WAAW,4CAAjB,CA+DA,GAAMc,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CAC1B9G,mBAAmB,CAAC,IAAD,CAAnB,CACD,CAFD,CAIA,GAAM+G,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,EAAM,CAC9B/G,mBAAmB,CAAC,KAAD,CAAnB,CACAgG,WAAW,GACZ,CAHD,CAKA,GAAMgB,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,EAAM,CAClChH,mBAAmB,CAAC,KAAD,CAAnB,CACD,CAFD,CAIA,GAAMiH,CAAAA,mBAAmB,CAAGnI,SAAS,CACjCoI,UAAU,CAACzL,MAAM,CAACgI,KAAP,CAAa0D,WAAb,CAAyBrI,SAAzB,CAAoCqB,MAAM,CAACvC,OAAD,CAAN,CAAgBL,QAApD,CAAD,CAAV,CAA4EW,QAD3C,CAEjC,IAFJ,CAGA,GAAMkJ,CAAAA,YAAY,CAAGxJ,OAAO,GAAK,KAAjC,CACA,GAAMyJ,CAAAA,qBAAqB,CAAG,CAACD,YAAD,CAC1B,KAD0B,CAE1BxI,eAAe,CACfsI,UAAU,CAACzL,MAAM,CAACgI,KAAP,CAAa0D,WAAb,CAAyBvI,eAAzB,CAA0CuB,MAAM,CAACvC,OAAD,CAAN,CAAgBL,QAA1D,CAAD,CAAV,CAAkFW,QADnE,CAEf,IAJJ,CAKA,GAAMoJ,CAAAA,kBAAkB,CAAGxI,SAAS,CAChCoI,UAAU,CAACzL,MAAM,CAACgI,KAAP,CAAa0D,WAAb,CAAyBrI,SAAzB,CAAoCqB,MAAM,CAACvC,OAAD,CAAN,CAAgBL,QAApD,CAAD,CAAV,CAA0EgK,WAA1E,CAAsF,CAAtF,CADgC,CAEhC,IAFJ,CAGA,GAAMC,CAAAA,mBAAmB,CAAGxI,UAAU,CAClCkI,UAAU,CAACzL,MAAM,CAACgI,KAAP,CAAa0D,WAAb,CAAyBnI,UAAzB,CAAqCmB,MAAM,CAACrC,QAAD,CAAN,CAAiBP,QAAtD,CAAD,CAAV,CAA4EgK,WAA5E,CAAwF,CAAxF,CADkC,CAElC,IAFJ,CAIA,GAAME,CAAAA,MAAM,CACVtH,MAAM,EAAIF,SAAV,EAAuBrC,OAAvB,CACIqC,SAAS,CAACyB,MAAV,CAAiB,SAAUC,CAAV,CAAa,CAC5B,MAAOA,CAAAA,CAAC,CAACrE,OAAF,GAAc6C,MAAM,CAACvC,OAAD,CAAN,CAAgBN,OAArC,CACD,CAFD,EAEG,CAFH,CADJ,CAII,IALN,CAMA,GAAMoK,CAAAA,OAAO,CACXvH,MAAM,EAAIF,SAAV,EAAuBnC,QAAvB,CACImC,SAAS,CAACyB,MAAV,CAAiB,SAAUC,CAAV,CAAa,CAC5B,MAAOA,CAAAA,CAAC,CAACrE,OAAF,GAAc6C,MAAM,CAACrC,QAAD,CAAN,CAAiBR,OAAtC,CACD,CAFD,EAEG,CAFH,CADJ,CAII,IALN,CAOA,GAAMqK,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAAAC,GAAG,CAAI,CAC1B,GAAI,CACF,MAAOA,CAAAA,GAAG,CAACC,OAAJ,CAAY,SAAZ,CAAuB,uBAAvB,CAAP,CACD,CAAC,MAAOC,CAAP,CAAU,CACVrL,OAAO,CAACC,GAAR,CAAYoL,CAAZ,CAAeF,GAAf,EACA,MAAOA,CAAAA,GAAP,CACD,CACF,CAPD,CASA,GAAMG,CAAAA,MAAM,CAAGN,MAAM,CAAGE,YAAY,CAACF,MAAM,CAAC5F,OAAR,CAAf,CAAkC,IAAvD,CACA,GAAMmG,CAAAA,OAAO,CAAGN,OAAO,CAAGC,YAAY,CAACD,OAAO,CAAC7F,OAAT,CAAf,CAAmC,IAA1D,CAEA,GAAMoG,CAAAA,QAAQ,CAAGvJ,MAAM,EAAIA,MAAM,CAAC,CAAD,CAAhB,CAAsBA,MAAM,CAAC,CAAD,CAAN,CAAUwJ,cAAhC,CAAiD,IAAlE,CACA,GAAMC,CAAAA,KAAK,CAAGF,QAAQ,CAAGA,QAAQ,CAACnE,aAAT,CAAuB,CAAvB,CAAH,CAA+B,IAArD,CACA,GAAMsE,CAAAA,gBAAgB,CAAGH,QAAQ,CAC7B5H,WAAW,WACN4H,QAAQ,CAACI,MAAT,GAAkBvE,aAAlB,CAAgC,CAAhC,CADM,aACgClG,OADhC,iBAC+CE,QAD/C,YAENqK,KAFM,aAEGrK,QAFH,iBAEmBF,OAFnB,CADkB,CAI7B,IAJJ,CAMA,GAAM0K,CAAAA,WAAW,cACf,MAAC,KAAD,yBACE,KAAC,IAAD,EAAM,IAAI,CAAC,WAAX,UAAwBF,gBAAxB,EADF,cAEE,KAAC,MAAD,EACE,IAAI,CAAC,MADP,CAEE,OAAO,CAAE,kBAAM,CACb9H,cAAc,CAAC,CAACD,WAAF,CAAd,CACD,CAJH,uBAME,KAAC,eAAD,IANF,EAFF,GADF,CAcA,GAAMkI,CAAAA,SAAS,cACb,MAAC,KAAD,EAAO,KAAK,CAAC,cAAb,CAA4B,OAAO,CAAExI,gBAArC,CAAuD,IAAI,CAAEgH,iBAA7D,CAAgF,QAAQ,CAAEC,qBAA1F,wBACE,KAAC,GAAD,wBACE,MAAC,KAAD,yBACE,YAAK,GAAG,CAAEe,MAAV,CAAkB,GAAG,CAAEnK,OAAvB,CAAgC,KAAK,CAAC,IAAtC,EADF,CAEGM,QAFH,CAGGN,OAHH,GADF,EADF,cAQE,KAAC,GAAD,EAAK,OAAO,CAAC,QAAb,CAAsB,KAAK,CAAC,QAA5B,CAAqC,KAAK,CAAE,CAAE4K,KAAK,CAAE,EAAT,CAA5C,uBACE,gCADF,EARF,cAWE,KAAC,GAAD,wBACE,MAAC,KAAD,yBACE,YAAK,GAAG,CAAER,OAAV,CAAmB,GAAG,CAAElK,QAAxB,CAAkC,KAAK,CAAC,IAAxC,EADF,CAEGQ,SAFH,CAGGR,QAHH,GADF,EAXF,cAkBE,KAAC,OAAD,IAlBF,cAmBE,KAAC,GAAD,WAAMwK,WAAN,EAnBF,cAoBE,KAAC,GAAD,WACG5J,MAAM,GAAMF,YAAY,EAAIR,KAAK,GAAK,IAA3B,EAAqCI,WAAW,EAAIJ,KAAK,GAAK,KAAnE,CAAN,CACGA,KAAK,GAAK,IAAV,0DACoDQ,YAAY,CAACsF,aAAb,CAChD,CADgD,CADpD,aAGOhG,QAHP,yFAI+CM,WAAW,CAAC0F,aAAZ,CAC3C,CAD2C,CAJ/C,aAMOlG,OANP,oCADH,CAQG,IATN,EApBF,GADF,CAmCA,mBACE,MAAC,IAAD,EACE,KAAK,cACH,MAAC,KAAD,yBACE,YAAK,GAAG,CAAC,qEAAT,CAA+E,KAAK,CAAC,IAArF,CAA0F,GAAG,CAAC,aAA9F,EADF,cAEE,KAAC,UAAD,yBAFF,GAFJ,CAOE,KAAK,cACH,KAAC,MAAD,EACE,IAAI,CAAC,MADP,CAEE,OAAO,CAAE,kBAAM,CACbkC,kBAAkB,CAAC,IAAD,CAAlB,CACD,CAJH,uBAME,KAAC,eAAD,IANF,EARJ,wBAkBE,MAAC,KAAD,EAAO,SAAS,CAAC,UAAjB,wBACE,KAAC,GAAD,EAAK,OAAO,CAAC,QAAb,CAAsB,KAAK,CAAC,QAA5B,uBACE,MAAC,IAAD,EACE,IAAI,CAAC,OADP,CAEE,IAAI,CAAC,OAFP,CAGE,KAAK,eAAS9B,KAAK,GAAK,KAAV,EAAmBJ,OAAnB,EAA8BE,QAA9B,CAAyC,aAAzC,CAAyD,EAAlE,CAHP,CAIE,KAAK,cACH,wCACE,YAAK,GAAG,CAAEiK,MAAV,CAAkB,GAAG,CAAEnK,OAAvB,CAAgC,KAAK,CAAC,IAAtC,EADF,cAEE,KAAC,MAAD,EACE,IAAI,CAAC,MADP,CAEE,OAAO,CAAE,kBAAM,CACbW,YAAY,GACZJ,WAAW,CAAC1C,MAAM,CAACgI,KAAP,CAAa0D,WAAb,CAAyBrI,SAAzB,CAAoCqB,MAAM,CAACvC,OAAD,CAAN,CAAgBL,QAApD,CAAD,CAAX,CACAkB,eAAe,GACfJ,cAAc,GACdJ,QAAQ,CAAC,IAAD,CAAR,CACD,CARH,UAUGqJ,kBAVH,EAFF,GALJ,CAqBE,KAAK,CAAE,CAAEkB,KAAK,CAAE,GAAT,CAAcC,SAAS,CAAE,MAAzB,CArBT,wBAuBE,KAAC,WAAD,EACE,KAAK,CAAE,CAAED,KAAK,CAAE,OAAT,CADT,CAEE,GAAG,CAAE,CAFP,CAGE,IAAI,CAAC,OAHP,CAIE,KAAK,CAAEtK,QAJT,CAKE,QAAQ,CAAE,kBAAA4J,CAAC,CAAI,CACbvJ,YAAY,GACZI,SAAS,GACTR,WAAW,CAAC2J,CAAD,CAAX,CACA7J,QAAQ,CAAC,IAAD,CAAR,CACD,CAVH,EAvBF,cAmCE,KAAC,MAAD,EACE,UAAU,KADZ,CAEE,KAAK,CAAEL,OAFT,CAGE,KAAK,CAAE,CAAE4K,KAAK,CAAE,OAAT,CAHT,CAIE,IAAI,CAAC,OAJP,CAKE,QAAQ,CAAE,KALZ,CAME,YAAY,CAAE7L,YANhB,CAOE,QAAQ,CAAE,kBAAA+J,KAAK,CAAI,CACjBjK,OAAO,CAACC,GAAR,CAAYgK,KAAZ,EACA,GAAIA,KAAK,GAAK5I,QAAd,CAAwB,CACtBrB,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuBkB,OAAvB,EACAG,WAAW,CAACH,OAAD,CAAX,CACAW,YAAY,CAACL,QAAD,CAAZ,CACAe,aAAa,CAACH,SAAD,CAAb,CACD,CACDjB,UAAU,CAAC6I,KAAD,CAAV,CACA/H,SAAS,GACTR,WAAW,GACXF,QAAQ,CAAC,KAAD,CAAR,CACAc,YAAY,GACb,CApBH,CAqBE,YAAY,CAAE,sBAAC2J,KAAD,CAAQC,MAAR,QAAmBA,CAAAA,MAAM,CAACC,QAAP,CAAgBC,WAAhB,GAA8BC,OAA9B,CAAsCJ,KAAK,CAACG,WAAN,EAAtC,GAA8D,CAAjF,EArBhB,CAsBE,gBAAgB,CAAC,UAtBnB,UAwBG5I,SAAS,CAACkC,GAAV,CAAc,SAAA4G,KAAK,qBAClB,KAAC,MAAD,EAA2B,KAAK,CAAEA,KAAK,CAAC3L,MAAxC,UACG2L,KAAK,CAAC3L,MADT,EAAa2L,KAAK,CAAC3L,MAAnB,CADkB,EAAnB,CAxBH,EAnCF,GADF,EADF,cAqEE,KAAC,GAAD,EAAK,OAAO,CAAC,QAAb,CAAsB,KAAK,CAAC,QAA5B,uBACE,KAAC,OAAD,EAAS,KAAK,CAAE4H,KAAK,CAACgE,IAAN,CAAW,IAAX,CAAhB,uBACE,gCADF,EADF,EArEF,cA0EE,KAAC,GAAD,EAAK,OAAO,CAAC,QAAb,CAAsB,KAAK,CAAC,QAA5B,uBACE,MAAC,IAAD,EACE,IAAI,CAAC,OADP,CAEE,IAAI,CAAC,OAFP,CAGE,KAAK,aAAOhL,KAAK,GAAK,IAAV,EAAkBJ,OAAlB,EAA6BE,QAA7B,CAAwC,aAAxC,CAAwD,EAA/D,CAHP,CAIE,KAAK,cACH,wCACE,YAAK,GAAG,CAAEkK,OAAV,CAAmB,KAAK,CAAC,IAAzB,CAA8B,GAAG,CAAElK,QAAnC,EADF,cAEE,KAAC,MAAD,EAAQ,IAAI,CAAC,MAAb,UAAqB0J,mBAArB,EAFF,GALJ,CAUE,KAAK,CAAE,CAAEgB,KAAK,CAAE,GAAT,CAAcC,SAAS,CAAE,MAAzB,CAVT,wBAYE,KAAC,WAAD,EACE,KAAK,CAAE,CAAED,KAAK,CAAE,OAAT,CADT,CAEE,IAAI,CAAC,OAFP,CAGE,GAAG,CAAE,CAHP,CAIE,KAAK,CAAElK,SAJT,CAKE,QAAQ,CAAE,kBAAAwJ,CAAC,CAAI,CACbvJ,YAAY,CAACuJ,CAAD,CAAZ,CACA3J,WAAW,GACXQ,SAAS,GACTV,QAAQ,CAAC,KAAD,CAAR,CACD,CAVH,EAZF,cAwBE,KAAC,MAAD,EACE,UAAU,KADZ,CAEE,KAAK,CAAEH,QAFT,CAGE,KAAK,CAAE,CAAE0K,KAAK,CAAE,OAAT,CAHT,CAIE,IAAI,CAAC,OAJP,CAKE,QAAQ,CAAE,KALZ,CAME,QAAQ,CAAE,kBAAA9B,KAAK,CAAI,CACjBjK,OAAO,CAACC,GAAR,CAAYgK,KAAZ,CAAmB9I,OAAnB,CAA4BE,QAA5B,EACA,GAAI4I,KAAK,GAAK9I,OAAd,CAAuB,CACrBnB,OAAO,CAACC,GAAR,CAAY,SAAZ,CAAuBoB,QAAvB,EACAD,UAAU,CAACC,QAAD,CAAV,CACAK,WAAW,CAACG,SAAD,CAAX,CACAS,YAAY,CAACC,UAAD,CAAZ,CACD,CACDjB,WAAW,CAAC2I,KAAD,CAAX,CACAzI,QAAQ,CAAC,IAAD,CAAR,CACAM,YAAY,GACZI,SAAS,GACTM,aAAa,GACd,CAnBH,CAoBE,YAAY,CAAE,sBAACyJ,KAAD,CAAQC,MAAR,QAAmBA,CAAAA,MAAM,CAACC,QAAP,CAAgBC,WAAhB,GAA8BC,OAA9B,CAAsCJ,KAAK,CAACG,WAAN,EAAtC,GAA8D,CAAjF,EApBhB,CAqBE,gBAAgB,CAAC,UArBnB,UAuBG5I,SAAS,CAACkC,GAAV,CAAc,SAAA4G,KAAK,qBAClB,KAAC,MAAD,EAA2B,KAAK,CAAEA,KAAK,CAAC3L,MAAxC,UACG2L,KAAK,CAAC3L,MADT,EAAa2L,KAAK,CAAC3L,MAAnB,CADkB,EAAnB,CAvBH,EAxBF,GADF,EA1EF,cAkIE,KAAC,GAAD,EAAK,OAAO,CAAC,QAAb,CAAsB,KAAK,CAAC,QAA5B,UACGgL,gBAAgB,CAAGE,WAAH,CAAiB,IADpC,EAlIF,cAqIE,KAAC,GAAD,EAAK,OAAO,CAAC,QAAb,CAAsB,KAAK,CAAC,QAA5B,uBACE,MAAC,KAAD,YACGlB,YAAY,cACX,KAAC,MAAD,EAAQ,IAAI,CAAC,OAAb,CAAqB,OAAO,CAAEzH,SAA9B,CAAyC,QAAQ,CAAE,CAAC0H,qBAApD,CAA2E,OAAO,CAAE5B,aAApF,UACG,CAAC4B,qBAAD,EAA0BnJ,QAA1B,EAAsCI,SAAtC,CAAkD,UAAlD,CAA+D,SADlE,EADW,CAIT,IALN,cAME,KAAC,MAAD,EACE,IAAI,CAAC,OADP,CAEE,OAAO,CAAEmB,QAFX,CAGE,QAAQ,CAAE4H,qBAAqB,EAAIJ,mBAAzB,EAAgD,CAAC/I,QAAjD,EAA6D,CAACI,SAH1E,CAIE,OAAO,CAAEwI,aAJX,UAMGG,mBAAmB,CAAG,sBAAH,CAA4B,OANlD,EANF,CAcGsB,SAdH,GADF,EArIF,GAlBF,cA0KE,KAAC,MAAD,EACE,OAAO,CAAE1I,eADX,CAEE,OAAO,CAAE,kBAAM,CACbC,kBAAkB,CAAC,KAAD,CAAlB,CACD,CAJH,CAKE,KAAK,CAAE,GALT,uBAOE,MAAC,YAAD,EAAc,KAAK,CAAC,SAApB,CAA8B,MAAM,CAAE,CAAtC,CAAyC,KAAK,CAAE,CAAE2I,SAAS,CAAE,MAAb,CAAhD,wBACE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,aAAzB,UAAwClI,WAAxC,EADF,cAEE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,iBAAzB,uBACE,MAAC,KAAD,YACG3B,eAAe,CAAGnD,MAAM,CAACgI,KAAP,CAAa0D,WAAb,CAAyBvI,eAAzB,CAA0CuB,MAAM,CAACvC,OAAD,CAAN,CAAgBL,QAA1D,CAAH,CAAyE,IAD3F,CAEGqB,eAAe,CAAG,CAAlB,cAAsB,KAAC,MAAD,EAAQ,OAAO,CAAEkH,qBAAjB,8BAAtB,CAA0F,IAF7F,GADF,EAFF,cAQE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,OAAzB,UAAkCd,KAAK,CAACgE,IAAN,CAAW,IAAX,CAAlC,EARF,cASE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,OAAzB,UAAkChL,KAAlC,EATF,cAUE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,WAAzB,UACGU,MAAM,CAAIA,MAAM,CAACuG,MAAP,CAAgB,CAAhB,CAAoBvG,MAAM,CAAC,CAAD,CAAN,CAAUwJ,cAAV,CAAyBpE,aAAzB,CAAuC,CAAvC,CAApB,CAAgE,IAApE,CAA4E,IADrF,EAVF,cAaE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,cAAzB,UACGpF,MAAM,CAAIA,MAAM,CAACuG,MAAP,CAAgB,CAAhB,CAAoBvG,MAAM,CAAC,CAAD,CAAN,CAAUuK,YAAV,CAAuBnF,aAAvB,CAAqC,CAArC,CAApB,CAA8D,IAAlE,CAA0E,IADnF,EAbF,cAgBE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,aAAzB,UACGpF,MAAM,CAAIA,MAAM,CAACuG,MAAP,CAAgB,CAAhB,CAAoBvG,MAAM,CAAC,CAAD,CAAN,CAAUwK,WAAV,CAAsBpF,aAAtB,CAAoC,CAApC,CAApB,CAA6D,IAAjE,CAAyE,IADlF,EAhBF,cAmBE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,mBAAzB,uBACE,KAAC,WAAD,EACE,YAAY,CAAEjH,eADhB,CAEE,GAAG,CAAE,CAFP,CAGE,GAAG,CAAE,GAHP,CAIE,SAAS,CAAE,CAJb,CAKE,SAAS,CAAE,mBAAA6J,KAAK,kBAAOA,KAAP,OALlB,CAME,MAAM,CAAE,gBAAAA,KAAK,QAAIA,CAAAA,KAAK,CAACmB,OAAN,CAAc,GAAd,CAAmB,EAAnB,CAAJ,EANf,CAOE,QAAQ,CAAE,kBAAAnB,KAAK,CAAI,CACjBjK,OAAO,CAACC,GAAR,CAAYgK,KAAZ,EAEA,GAAMyC,CAAAA,eAAe,CAAG,GAAIhP,CAAAA,OAAJ,CAAY+E,IAAI,CAACC,KAAL,CAAWuH,KAAK,CAAG,GAAnB,EAAwBtH,QAAxB,EAAZ,CAAgD,OAAhD,CAAxB,CACAE,oBAAoB,CAAC6J,eAAD,CAApB,CACD,CAZH,EADF,EAnBF,cAmCE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,aAAzB,UAAwC/K,WAAW,CAAGA,WAAW,CAACgL,OAAZ,EAAH,CAA2B,IAA9E,EAnCF,cAoCE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,cAAzB,UAAyC5K,YAAY,CAAGA,YAAY,CAAC4K,OAAb,EAAH,CAA4B,IAAjF,EApCF,cAqCE,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,oBAAzB,uBACE,KAAC,WAAD,EACE,GAAG,CAAE,CADP,CAEE,GAAG,CAAE,IAFP,CAGE,YAAY,CAAEtM,gBAHhB,CAIE,QAAQ,CAAE,kBAAA4J,KAAK,CAAI,CACjBjK,OAAO,CAACC,GAAR,CAAYgK,KAAZ,EACAlH,YAAY,CAACkH,KAAD,CAAZ,CACD,CAPH,EADF,EArCF,GAPF,EA1KF,GADF,CAsOD,CAED,cAAejJ,CAAAA,IAAf","sourcesContent":["import { RetweetOutlined, SettingOutlined } from \"@ant-design/icons\";\r\nimport { ChainId, Fetcher, Percent, Token, TokenAmount, Trade, WETH } from \"@uniswap/sdk\";\r\nimport { abi as IUniswapV2Router02ABI } from \"@uniswap/v2-periphery/build/IUniswapV2Router02.json\";\r\nimport {\r\n  Button,\r\n  Card,\r\n  Descriptions,\r\n  Divider,\r\n  Drawer,\r\n  InputNumber,\r\n  Modal,\r\n  notification,\r\n  Row,\r\n  Select,\r\n  Space,\r\n  Tooltip,\r\n  Typography,\r\n} from \"antd\";\r\nimport { useBlockNumber, usePoller } from \"eth-hooks\";\r\nimport { ethers } from \"ethers\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useDebounce } from \"../hooks\";\r\n\r\nconst { Option } = Select;\r\nconst { Text } = Typography;\r\n\r\nexport const ROUTER_ADDRESS = \"0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D\";\r\n\r\nexport const ZERO_ADDRESS = \"0x0000000000000000000000000000000000000000\";\r\n\r\nconst erc20Abi = [\r\n  \"function balanceOf(address owner) view returns (uint256)\",\r\n  \"function approve(address _spender, uint256 _value) public returns (bool success)\",\r\n  \"function allowance(address _owner, address _spender) public view returns (uint256 remaining)\",\r\n];\r\n\r\nconst makeCall = async (callName, contract, args, metadata = {}) => {\r\n  if (contract[callName]) {\r\n    let result;\r\n    if (args) {\r\n      result = await contract[callName](...args, metadata);\r\n    } else {\r\n      result = await contract[callName]();\r\n    }\r\n    return result;\r\n  }\r\n  console.log(\"no call of that name!\");\r\n};\r\n\r\nconst defaultToken = \"ETH\";\r\nconst defaultTokenOut = \"DAI\";\r\nconst defaultSlippage = \"0.5\";\r\nconst defaultTimeLimit = 60 * 10;\r\n\r\nconst tokenListToObject = array =>\r\n  array.reduce((obj, item) => {\r\n    obj[item.symbol] = new Token(item.chainId, item.address, item.decimals, item.symbol, item.name);\r\n    return obj;\r\n  }, {});\r\n\r\nfunction Swap({ selectedProvider, tokenListURI }) {\r\n  const [tokenIn, setTokenIn] = useState(defaultToken);\r\n  const [tokenOut, setTokenOut] = useState(defaultTokenOut);\r\n  const [exact, setExact] = useState();\r\n  const [amountIn, setAmountIn] = useState();\r\n  const [amountInMax, setAmountInMax] = useState();\r\n  const [amountOut, setAmountOut] = useState();\r\n  const [amountOutMin, setAmountOutMin] = useState();\r\n  const [trades, setTrades] = useState();\r\n  const [routerAllowance, setRouterAllowance] = useState();\r\n  const [balanceIn, setBalanceIn] = useState();\r\n  const [balanceOut, setBalanceOut] = useState();\r\n  const [slippageTolerance, setSlippageTolerance] = useState(\r\n    new Percent(Math.round(defaultSlippage * 100).toString(), \"10000\"),\r\n  );\r\n  const [timeLimit, setTimeLimit] = useState(defaultTimeLimit);\r\n  const [swapping, setSwapping] = useState(false);\r\n  const [approving, setApproving] = useState(false);\r\n  const [settingsVisible, setSettingsVisible] = useState(false);\r\n  const [swapModalVisible, setSwapModalVisible] = useState(false);\r\n\r\n  const [tokenList, setTokenList] = useState([]);\r\n\r\n  const [tokens, setTokens] = useState();\r\n\r\n  const [invertPrice, setInvertPrice] = useState(false);\r\n\r\n  const blockNumber = useBlockNumber(selectedProvider, 3000);\r\n\r\n  const signer = selectedProvider.getSigner();\r\n  const routerContract = new ethers.Contract(ROUTER_ADDRESS, IUniswapV2Router02ABI, signer);\r\n\r\n  const _tokenListUri = tokenListURI || \"https://gateway.ipfs.io/ipns/tokens.uniswap.org\";\r\n\r\n  const debouncedAmountIn = useDebounce(amountIn, 500);\r\n  const debouncedAmountOut = useDebounce(amountOut, 500);\r\n\r\n  const activeChainId = process.env.REACT_APP_NETWORK === \"kovan\" ? ChainId.KOVAN : ChainId.MAINNET;\r\n\r\n  useEffect(() => {\r\n    const getTokenList = async () => {\r\n      console.log(_tokenListUri);\r\n      try {\r\n        const tokenList = await fetch(_tokenListUri);\r\n        const tokenListJson = await tokenList.json();\r\n        const filteredTokens = tokenListJson.tokens.filter(function (t) {\r\n          return t.chainId === activeChainId;\r\n        });\r\n        const ethToken = WETH[activeChainId];\r\n        ethToken.name = \"Ethereum\";\r\n        ethToken.symbol = \"ETH\";\r\n        ethToken.logoURI =\r\n          \"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png\";\r\n        const _tokenList = [ethToken, ...filteredTokens];\r\n        setTokenList(_tokenList);\r\n        const _tokens = tokenListToObject(_tokenList);\r\n        setTokens(_tokens);\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n    };\r\n    getTokenList();\r\n  }, [tokenListURI]);\r\n\r\n  const getTrades = async () => {\r\n    if (tokenIn && tokenOut && (amountIn || amountOut)) {\r\n      const pairs = arr => arr.map((v, i) => arr.slice(i + 1).map(w => [v, w])).flat();\r\n\r\n      const baseTokens = tokenList\r\n        .filter(function (t) {\r\n          return [\"DAI\", \"USDC\", \"USDT\", \"COMP\", \"ETH\", \"MKR\", \"LINK\", tokenIn, tokenOut].includes(t.symbol);\r\n        })\r\n        .map(el => {\r\n          return new Token(el.chainId, el.address, el.decimals, el.symbol, el.name);\r\n        });\r\n\r\n      const listOfPairwiseTokens = pairs(baseTokens);\r\n\r\n      const getPairs = async list => {\r\n        const listOfPromises = list.map(item => Fetcher.fetchPairData(item[0], item[1], selectedProvider));\r\n        return Promise.all(listOfPromises.map(p => p.catch(() => undefined)));\r\n      };\r\n\r\n      const listOfPairs = await getPairs(listOfPairwiseTokens);\r\n\r\n      let bestTrade;\r\n\r\n      if (exact === \"in\") {\r\n        setAmountInMax();\r\n        bestTrade = Trade.bestTradeExactIn(\r\n          listOfPairs.filter(item => item),\r\n          new TokenAmount(tokens[tokenIn], ethers.utils.parseUnits(amountIn.toString(), tokens[tokenIn].decimals)),\r\n          tokens[tokenOut],\r\n          { maxNumResults: 3, maxHops: 1 },\r\n        );\r\n        if (bestTrade[0]) {\r\n          setAmountOut(bestTrade[0].outputAmount.toSignificant(6));\r\n        } else {\r\n          setAmountOut();\r\n        }\r\n      } else if (exact === \"out\") {\r\n        setAmountOutMin();\r\n        bestTrade = Trade.bestTradeExactOut(\r\n          listOfPairs.filter(item => item),\r\n          tokens[tokenIn],\r\n          new TokenAmount(tokens[tokenOut], ethers.utils.parseUnits(amountOut.toString(), tokens[tokenOut].decimals)),\r\n          { maxNumResults: 3, maxHops: 1 },\r\n        );\r\n        if (bestTrade[0]) {\r\n          setAmountIn(bestTrade[0].inputAmount.toSignificant(6));\r\n        } else {\r\n          setAmountIn();\r\n        }\r\n      }\r\n\r\n      setTrades(bestTrade);\r\n\r\n      console.log(bestTrade);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    getTrades();\r\n  }, [tokenIn, tokenOut, debouncedAmountIn, debouncedAmountOut, slippageTolerance, selectedProvider]);\r\n\r\n  useEffect(() => {\r\n    if (trades && trades[0]) {\r\n      if (exact === \"in\") {\r\n        setAmountOutMin(trades[0].minimumAmountOut(slippageTolerance));\r\n      } else if (exact === \"out\") {\r\n        setAmountInMax(trades[0].maximumAmountIn(slippageTolerance));\r\n      }\r\n    }\r\n  }, [slippageTolerance, amountIn, amountOut, trades]);\r\n\r\n  const getBalance = async (_token, _account, _contract) => {\r\n    let newBalance;\r\n    if (_token === \"ETH\") {\r\n      newBalance = await selectedProvider.getBalance(_account);\r\n    } else {\r\n      newBalance = await makeCall(\"balanceOf\", _contract, [_account]);\r\n    }\r\n    return newBalance;\r\n  };\r\n\r\n  const getAccountInfo = async () => {\r\n    if (tokens) {\r\n      const accountList = await selectedProvider.listAccounts();\r\n\r\n      if (tokenIn) {\r\n        const tempContractIn = new ethers.Contract(tokens[tokenIn].address, erc20Abi, selectedProvider);\r\n        const newBalanceIn = await getBalance(tokenIn, accountList[0], tempContractIn);\r\n        setBalanceIn(newBalanceIn);\r\n\r\n        let allowance;\r\n\r\n        if (tokenIn === \"ETH\") {\r\n          setRouterAllowance();\r\n        } else {\r\n          allowance = await makeCall(\"allowance\", tempContractIn, [accountList[0], ROUTER_ADDRESS]);\r\n          setRouterAllowance(allowance);\r\n        }\r\n      }\r\n\r\n      if (tokenOut) {\r\n        const tempContractOut = new ethers.Contract(tokens[tokenOut].address, erc20Abi, selectedProvider);\r\n        const newBalanceOut = await getBalance(tokenOut, accountList[0], tempContractOut);\r\n        setBalanceOut(newBalanceOut);\r\n      }\r\n    }\r\n  };\r\n\r\n  usePoller(getAccountInfo, 6000);\r\n\r\n  const route = trades\r\n    ? trades.length > 0\r\n      ? trades[0].route.path.map(function (item) {\r\n          return item.symbol;\r\n        })\r\n      : []\r\n    : [];\r\n\r\n  const updateRouterAllowance = async newAllowance => {\r\n    setApproving(true);\r\n    try {\r\n      const tempContract = new ethers.Contract(tokens[tokenIn].address, erc20Abi, signer);\r\n      const result = await makeCall(\"approve\", tempContract, [ROUTER_ADDRESS, newAllowance]);\r\n      console.log(result);\r\n      setApproving(false);\r\n      return true;\r\n    } catch (e) {\r\n      notification.open({\r\n        message: \"Approval unsuccessful\",\r\n        description: `Error: ${e.message}`,\r\n      });\r\n    }\r\n  };\r\n\r\n  const approveRouter = async () => {\r\n    const approvalAmount =\r\n      exact === \"in\"\r\n        ? ethers.utils.hexlify(ethers.utils.parseUnits(amountIn.toString(), tokens[tokenIn].decimals))\r\n        : amountInMax.raw.toString();\r\n    console.log(approvalAmount);\r\n    const approval = updateRouterAllowance(approvalAmount);\r\n    if (approval) {\r\n      notification.open({\r\n        message: \"Token transfer approved\",\r\n        description: `You can now swap up to ${amountIn} ${tokenIn}`,\r\n      });\r\n    }\r\n  };\r\n\r\n  const removeRouterAllowance = async () => {\r\n    const approvalAmount = ethers.utils.hexlify(0);\r\n    console.log(approvalAmount);\r\n    const removal = updateRouterAllowance(approvalAmount);\r\n    if (removal) {\r\n      notification.open({\r\n        message: \"Token approval removed\",\r\n        description: `The router is no longer approved for ${tokenIn}`,\r\n      });\r\n    }\r\n  };\r\n\r\n  const executeSwap = async () => {\r\n    setSwapping(true);\r\n    try {\r\n      let args;\r\n      const metadata = {};\r\n\r\n      let call;\r\n      const deadline = Math.floor(Date.now() / 1000) + timeLimit;\r\n      const path = trades[0].route.path.map(function (item) {\r\n        return item.address;\r\n      });\r\n      console.log(path);\r\n      const accountList = await selectedProvider.listAccounts();\r\n      const address = accountList[0];\r\n\r\n      if (exact === \"in\") {\r\n        const _amountIn = ethers.utils.hexlify(ethers.utils.parseUnits(amountIn.toString(), tokens[tokenIn].decimals));\r\n        const _amountOutMin = ethers.utils.hexlify(ethers.BigNumber.from(amountOutMin.raw.toString()));\r\n        if (tokenIn === \"ETH\") {\r\n          call = \"swapExactETHForTokens\";\r\n          args = [_amountOutMin, path, address, deadline];\r\n          metadata.value = _amountIn;\r\n        } else {\r\n          call = tokenOut === \"ETH\" ? \"swapExactTokensForETH\" : \"swapExactTokensForTokens\";\r\n          args = [_amountIn, _amountOutMin, path, address, deadline];\r\n        }\r\n      } else if (exact === \"out\") {\r\n        const _amountOut = ethers.utils.hexlify(\r\n          ethers.utils.parseUnits(amountOut.toString(), tokens[tokenOut].decimals),\r\n        );\r\n        const _amountInMax = ethers.utils.hexlify(ethers.BigNumber.from(amountInMax.raw.toString()));\r\n        if (tokenIn === \"ETH\") {\r\n          call = \"swapETHForExactTokens\";\r\n          args = [_amountOut, path, address, deadline];\r\n          metadata.value = _amountInMax;\r\n        } else {\r\n          call = tokenOut === \"ETH\" ? \"swapTokensForExactETH\" : \"swapTokensForExactTokens\";\r\n          args = [_amountOut, _amountInMax, path, address, deadline];\r\n        }\r\n      }\r\n      console.log(call, args, metadata);\r\n      const result = await makeCall(call, routerContract, args, metadata);\r\n      console.log(result);\r\n      notification.open({\r\n        message: \"Swap complete ðŸ¦„\",\r\n        description: (\r\n          <>\r\n            <Text>{`Swapped ${tokenIn} for ${tokenOut}, transaction: `}</Text>\r\n            <Text copyable>{result.hash}</Text>\r\n          </>\r\n        ),\r\n      });\r\n      setSwapping(false);\r\n    } catch (e) {\r\n      console.log(e);\r\n      setSwapping(false);\r\n      notification.open({\r\n        message: \"Swap unsuccessful\",\r\n        description: `Error: ${e.message}`,\r\n      });\r\n    }\r\n  };\r\n\r\n  const showSwapModal = () => {\r\n    setSwapModalVisible(true);\r\n  };\r\n\r\n  const handleSwapModalOk = () => {\r\n    setSwapModalVisible(false);\r\n    executeSwap();\r\n  };\r\n\r\n  const handleSwapModalCancel = () => {\r\n    setSwapModalVisible(false);\r\n  };\r\n\r\n  const insufficientBalance = balanceIn\r\n    ? parseFloat(ethers.utils.formatUnits(balanceIn, tokens[tokenIn].decimals)) < amountIn\r\n    : null;\r\n  const inputIsToken = tokenIn !== \"ETH\";\r\n  const insufficientAllowance = !inputIsToken\r\n    ? false\r\n    : routerAllowance\r\n    ? parseFloat(ethers.utils.formatUnits(routerAllowance, tokens[tokenIn].decimals)) < amountIn\r\n    : null;\r\n  const formattedBalanceIn = balanceIn\r\n    ? parseFloat(ethers.utils.formatUnits(balanceIn, tokens[tokenIn].decimals)).toPrecision(6)\r\n    : null;\r\n  const formattedBalanceOut = balanceOut\r\n    ? parseFloat(ethers.utils.formatUnits(balanceOut, tokens[tokenOut].decimals)).toPrecision(6)\r\n    : null;\r\n\r\n  const metaIn =\r\n    tokens && tokenList && tokenIn\r\n      ? tokenList.filter(function (t) {\r\n          return t.address === tokens[tokenIn].address;\r\n        })[0]\r\n      : null;\r\n  const metaOut =\r\n    tokens && tokenList && tokenOut\r\n      ? tokenList.filter(function (t) {\r\n          return t.address === tokens[tokenOut].address;\r\n        })[0]\r\n      : null;\r\n\r\n  const cleanIpfsURI = uri => {\r\n    try {\r\n      return uri.replace(\"ipfs://\", \"https://ipfs.io/ipfs/\");\r\n    } catch (e) {\r\n      console.log(e, uri);\r\n      return uri;\r\n    }\r\n  };\r\n\r\n  const logoIn = metaIn ? cleanIpfsURI(metaIn.logoURI) : null;\r\n  const logoOut = metaOut ? cleanIpfsURI(metaOut.logoURI) : null;\r\n\r\n  const rawPrice = trades && trades[0] ? trades[0].executionPrice : null;\r\n  const price = rawPrice ? rawPrice.toSignificant(7) : null;\r\n  const priceDescription = rawPrice\r\n    ? invertPrice\r\n      ? `${rawPrice.invert().toSignificant(7)} ${tokenIn} per ${tokenOut}`\r\n      : `${price} ${tokenOut} per ${tokenIn}`\r\n    : null;\r\n\r\n  const priceWidget = (\r\n    <Space>\r\n      <Text type=\"secondary\">{priceDescription}</Text>\r\n      <Button\r\n        type=\"text\"\r\n        onClick={() => {\r\n          setInvertPrice(!invertPrice);\r\n        }}\r\n      >\r\n        <RetweetOutlined />\r\n      </Button>\r\n    </Space>\r\n  );\r\n\r\n  const swapModal = (\r\n    <Modal title=\"Confirm swap\" visible={swapModalVisible} onOk={handleSwapModalOk} onCancel={handleSwapModalCancel}>\r\n      <Row>\r\n        <Space>\r\n          <img src={logoIn} alt={tokenIn} width=\"30\" />\r\n          {amountIn}\r\n          {tokenIn}\r\n        </Space>\r\n      </Row>\r\n      <Row justify=\"center\" align=\"middle\" style={{ width: 30 }}>\r\n        <span>â†“</span>\r\n      </Row>\r\n      <Row>\r\n        <Space>\r\n          <img src={logoOut} alt={tokenOut} width=\"30\" />\r\n          {amountOut}\r\n          {tokenOut}\r\n        </Space>\r\n      </Row>\r\n      <Divider />\r\n      <Row>{priceWidget}</Row>\r\n      <Row>\r\n        {trades && ((amountOutMin && exact === \"in\") || (amountInMax && exact === \"out\"))\r\n          ? exact === \"in\"\r\n            ? `Output is estimated. You will receive at least ${amountOutMin.toSignificant(\r\n                6,\r\n              )} ${tokenOut} or the transaction will revert.`\r\n            : `Input is estimated. You will sell at most ${amountInMax.toSignificant(\r\n                6,\r\n              )} ${tokenIn} or the transaction will revert.`\r\n          : null}\r\n      </Row>\r\n    </Modal>\r\n  );\r\n\r\n  return (\r\n    <Card\r\n      title={\r\n        <Space>\r\n          <img src=\"https://ipfs.io/ipfs/QmXttGpZrECX5qCyXbBQiqgQNytVGeZW5Anewvh2jc4psg\" width=\"40\" alt=\"uniswapLogo\" />\r\n          <Typography>Uniswapper</Typography>\r\n        </Space>\r\n      }\r\n      extra={\r\n        <Button\r\n          type=\"text\"\r\n          onClick={() => {\r\n            setSettingsVisible(true);\r\n          }}\r\n        >\r\n          <SettingOutlined />\r\n        </Button>\r\n      }\r\n    >\r\n      <Space direction=\"vertical\">\r\n        <Row justify=\"center\" align=\"middle\">\r\n          <Card\r\n            size=\"small\"\r\n            type=\"inner\"\r\n            title={`From${exact === \"out\" && tokenIn && tokenOut ? \" (estimate)\" : \"\"}`}\r\n            extra={\r\n              <>\r\n                <img src={logoIn} alt={tokenIn} width=\"30\" />\r\n                <Button\r\n                  type=\"link\"\r\n                  onClick={() => {\r\n                    setAmountOut();\r\n                    setAmountIn(ethers.utils.formatUnits(balanceIn, tokens[tokenIn].decimals));\r\n                    setAmountOutMin();\r\n                    setAmountInMax();\r\n                    setExact(\"in\");\r\n                  }}\r\n                >\r\n                  {formattedBalanceIn}\r\n                </Button>\r\n              </>\r\n            }\r\n            style={{ width: 400, textAlign: \"left\" }}\r\n          >\r\n            <InputNumber\r\n              style={{ width: \"160px\" }}\r\n              min={0}\r\n              size=\"large\"\r\n              value={amountIn}\r\n              onChange={e => {\r\n                setAmountOut();\r\n                setTrades();\r\n                setAmountIn(e);\r\n                setExact(\"in\");\r\n              }}\r\n            />\r\n            <Select\r\n              showSearch\r\n              value={tokenIn}\r\n              style={{ width: \"120px\" }}\r\n              size=\"large\"\r\n              bordered={false}\r\n              defaultValue={defaultToken}\r\n              onChange={value => {\r\n                console.log(value);\r\n                if (value === tokenOut) {\r\n                  console.log(\"switch!\", tokenIn);\r\n                  setTokenOut(tokenIn);\r\n                  setAmountOut(amountIn);\r\n                  setBalanceOut(balanceIn);\r\n                }\r\n                setTokenIn(value);\r\n                setTrades();\r\n                setAmountIn();\r\n                setExact(\"out\");\r\n                setBalanceIn();\r\n              }}\r\n              filterOption={(input, option) => option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0}\r\n              optionFilterProp=\"children\"\r\n            >\r\n              {tokenList.map(token => (\r\n                <Option key={token.symbol} value={token.symbol}>\r\n                  {token.symbol}\r\n                </Option>\r\n              ))}\r\n            </Select>\r\n          </Card>\r\n        </Row>\r\n        <Row justify=\"center\" align=\"middle\">\r\n          <Tooltip title={route.join(\"->\")}>\r\n            <span>â†“</span>\r\n          </Tooltip>\r\n        </Row>\r\n        <Row justify=\"center\" align=\"middle\">\r\n          <Card\r\n            size=\"small\"\r\n            type=\"inner\"\r\n            title={`To${exact === \"in\" && tokenIn && tokenOut ? \" (estimate)\" : \"\"}`}\r\n            extra={\r\n              <>\r\n                <img src={logoOut} width=\"30\" alt={tokenOut} />\r\n                <Button type=\"text\">{formattedBalanceOut}</Button>\r\n              </>\r\n            }\r\n            style={{ width: 400, textAlign: \"left\" }}\r\n          >\r\n            <InputNumber\r\n              style={{ width: \"160px\" }}\r\n              size=\"large\"\r\n              min={0}\r\n              value={amountOut}\r\n              onChange={e => {\r\n                setAmountOut(e);\r\n                setAmountIn();\r\n                setTrades();\r\n                setExact(\"out\");\r\n              }}\r\n            />\r\n            <Select\r\n              showSearch\r\n              value={tokenOut}\r\n              style={{ width: \"120px\" }}\r\n              size=\"large\"\r\n              bordered={false}\r\n              onChange={value => {\r\n                console.log(value, tokenIn, tokenOut);\r\n                if (value === tokenIn) {\r\n                  console.log(\"switch!\", tokenOut);\r\n                  setTokenIn(tokenOut);\r\n                  setAmountIn(amountOut);\r\n                  setBalanceIn(balanceOut);\r\n                }\r\n                setTokenOut(value);\r\n                setExact(\"in\");\r\n                setAmountOut();\r\n                setTrades();\r\n                setBalanceOut();\r\n              }}\r\n              filterOption={(input, option) => option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0}\r\n              optionFilterProp=\"children\"\r\n            >\r\n              {tokenList.map(token => (\r\n                <Option key={token.symbol} value={token.symbol}>\r\n                  {token.symbol}\r\n                </Option>\r\n              ))}\r\n            </Select>\r\n          </Card>\r\n        </Row>\r\n        <Row justify=\"center\" align=\"middle\">\r\n          {priceDescription ? priceWidget : null}\r\n        </Row>\r\n        <Row justify=\"center\" align=\"middle\">\r\n          <Space>\r\n            {inputIsToken ? (\r\n              <Button size=\"large\" loading={approving} disabled={!insufficientAllowance} onClick={approveRouter}>\r\n                {!insufficientAllowance && amountIn && amountOut ? \"Approved\" : \"Approve\"}\r\n              </Button>\r\n            ) : null}\r\n            <Button\r\n              size=\"large\"\r\n              loading={swapping}\r\n              disabled={insufficientAllowance || insufficientBalance || !amountIn || !amountOut}\r\n              onClick={showSwapModal}\r\n            >\r\n              {insufficientBalance ? \"Insufficient balance\" : \"Swap!\"}\r\n            </Button>\r\n            {swapModal}\r\n          </Space>\r\n        </Row>\r\n      </Space>\r\n      <Drawer\r\n        visible={settingsVisible}\r\n        onClose={() => {\r\n          setSettingsVisible(false);\r\n        }}\r\n        width={500}\r\n      >\r\n        <Descriptions title=\"Details\" column={1} style={{ textAlign: \"left\" }}>\r\n          <Descriptions.Item label=\"blockNumber\">{blockNumber}</Descriptions.Item>\r\n          <Descriptions.Item label=\"routerAllowance\">\r\n            <Space>\r\n              {routerAllowance ? ethers.utils.formatUnits(routerAllowance, tokens[tokenIn].decimals) : null}\r\n              {routerAllowance > 0 ? <Button onClick={removeRouterAllowance}>Remove Allowance</Button> : null}\r\n            </Space>\r\n          </Descriptions.Item>\r\n          <Descriptions.Item label=\"route\">{route.join(\"->\")}</Descriptions.Item>\r\n          <Descriptions.Item label=\"exact\">{exact}</Descriptions.Item>\r\n          <Descriptions.Item label=\"bestPrice\">\r\n            {trades ? (trades.length > 0 ? trades[0].executionPrice.toSignificant(6) : null) : null}\r\n          </Descriptions.Item>\r\n          <Descriptions.Item label=\"nextMidPrice\">\r\n            {trades ? (trades.length > 0 ? trades[0].nextMidPrice.toSignificant(6) : null) : null}\r\n          </Descriptions.Item>\r\n          <Descriptions.Item label=\"priceImpact\">\r\n            {trades ? (trades.length > 0 ? trades[0].priceImpact.toSignificant(6) : null) : null}\r\n          </Descriptions.Item>\r\n          <Descriptions.Item label=\"slippageTolerance\">\r\n            <InputNumber\r\n              defaultValue={defaultSlippage}\r\n              min={0}\r\n              max={100}\r\n              precision={2}\r\n              formatter={value => `${value}%`}\r\n              parser={value => value.replace(\"%\", \"\")}\r\n              onChange={value => {\r\n                console.log(value);\r\n\r\n                const slippagePercent = new Percent(Math.round(value * 100).toString(), \"10000\");\r\n                setSlippageTolerance(slippagePercent);\r\n              }}\r\n            />\r\n          </Descriptions.Item>\r\n          <Descriptions.Item label=\"amountInMax\">{amountInMax ? amountInMax.toExact() : null}</Descriptions.Item>\r\n          <Descriptions.Item label=\"amountOutMin\">{amountOutMin ? amountOutMin.toExact() : null}</Descriptions.Item>\r\n          <Descriptions.Item label=\"timeLimitInSeconds\">\r\n            <InputNumber\r\n              min={0}\r\n              max={3600}\r\n              defaultValue={defaultTimeLimit}\r\n              onChange={value => {\r\n                console.log(value);\r\n                setTimeLimit(value);\r\n              }}\r\n            />\r\n          </Descriptions.Item>\r\n        </Descriptions>\r\n      </Drawer>\r\n    </Card>\r\n  );\r\n}\r\n\r\nexport default Swap;\r\n"]},"metadata":{},"sourceType":"module"}